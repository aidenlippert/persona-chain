const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GitHubAPIService-DDH1Imxf.js","assets/index-BVH3G8-4.js","assets/index-tl5-kq3o.css","assets/didService-BQO5nZK8.js"])))=>i.map(i=>d[i]);
import{r as b,u as N,an as E,_ as I,e as T,j as e,m as d}from"./index-BVH3G8-4.js";const k=({platform:h})=>{const[l,i]=b.useState("loading"),[j,t]=b.useState("Processing OAuth..."),[n,A]=b.useState(null),[f,y]=b.useState(null),w=N(),[o]=E();b.useEffect(()=>{O()},[]);const O=async()=>{try{const a=o.get("code"),m=o.get("state"),g=o.get("error"),u=o.get("credential"),S=o.get("success");console.log("ðŸš€ðŸš€ðŸš€ EXTREME OAUTH CALLBACK HEAVY DEBUG START ðŸš€ðŸš€ðŸš€");const v={url:window.location.href,fullUrl:window.location.toString(),origin:window.location.origin,pathname:window.location.pathname,search:window.location.search,hash:window.location.hash,code:a?`${a.substring(0,20)}...`:"âŒ CODE IS NULL",codeLength:a?.length||0,codeType:typeof a,state:m?`${m.substring(0,20)}...`:"âŒ STATE IS NULL",stateLength:m?.length||0,stateType:typeof m,error:g||"none",platform:h,allParams:Object.fromEntries(o.entries()),allParamsKeys:Array.from(o.keys()),allParamsValues:Array.from(o.values()),sessionState:sessionStorage.getItem("github_oauth_state"),localState:localStorage.getItem("github_oauth_state_backup"),allSessionKeys:Object.keys(sessionStorage),allLocalKeys:Object.keys(localStorage),userAgent:navigator.userAgent.substring(0,100),referrer:document.referrer,timestamp:new Date().toISOString(),windowOpener:!!window.opener,windowParent:window.parent!==window,isPopup:window.opener!==null,windowFeatures:{innerWidth:window.innerWidth,innerHeight:window.innerHeight,screen:{width:window.screen.width,height:window.screen.height}}};if(A(v),console.log("ðŸ”ðŸ”ðŸ” OAUTH CALLBACK EXTREME DEBUG:",JSON.stringify(v,null,2)),console.log("ðŸ”‘ GitHub credentials configured:",!0),S==="true"&&u){console.log("ðŸŽ‰ Railway backend OAuth success detected!"),console.log("ðŸ“¦ Credential data received:",u.substring(0,200)+"...");try{const c=JSON.parse(decodeURIComponent(u));console.log("âœ… Parsed credential data:",c),t("GitHub credential received! Storing...");const r=JSON.parse(localStorage.getItem("credentials")||"[]");if(r.push(c),localStorage.setItem("credentials",JSON.stringify(r)),console.log("âœ… Railway OAuth credential stored! Total credentials:",r.length),i("success"),t("GitHub developer credential created successfully via Railway!"),window.opener){window.opener.postMessage({type:"GITHUB_OAUTH_SUCCESS",credential:c,username:c.credentialSubject?.login||"Unknown User"},window.location.origin),window.close();return}setTimeout(()=>{w("/credentials")},2e3);return}catch(c){console.error("âŒ Failed to parse credential data:",c),i("error"),t("Failed to process credential data");return}}if(g){console.error("ðŸš¨ GitHub returned error parameter:",g),console.log("ðŸ” Error analysis:",{errorParam:g,errorDescription:o.get("error_description"),errorURI:o.get("error_uri"),allParams:Object.fromEntries(o.entries())}),i("error"),t(`GitHub OAuth error: ${g}`),y(`GitHub returned error: ${g} - ${o.get("error_description")||"No description"}`);return}if(!a){console.error("âŒ No code parameter found - checking if this is a Railway success response..."),console.log("ðŸ” Parameters check:",{success:S,credential:!!u,hasCredentialData:u?.length>0}),u?(i("success"),t("OAuth completed! Refresh the page to see your credential.")):(i("error"),t("Missing OAuth code parameter"));return}if(console.log("â„¹ï¸ State parameter check skipped - not required for demo flow"),t("Processing authentication..."),h==="github"){console.log("ðŸ™ðŸ™ðŸ™ STARTING GITHUB OAUTH PROCESSING WITH HEAVY DEBUG");const{githubAPIService:c}=await I(async()=>{const{githubAPIService:r}=await import("./GitHubAPIService-DDH1Imxf.js");return{githubAPIService:r}},__vite__mapDeps([0,1,2,3]));try{console.log("ðŸ”„ About to call githubAPIService.exchangeCodeForToken..."),t("Exchanging OAuth code with GitHub...");const r=await c.exchangeCodeForToken(a,m||"");console.log("âœ… exchangeCodeForToken completed successfully, result:",r),t("GitHub OAuth exchange successful! Getting credential...");const s=c.getStoredCredential();if(console.log("ðŸŽ« Retrieved credential from service:",{hasCredential:!!s,credentialType:typeof s,credentialId:s?.id,credentialPreview:s?JSON.stringify(s).substring(0,300)+"...":"null"}),!s)throw console.error("âŒ No credential received from GitHub OAuth service"),new Error("No credential received from GitHub OAuth");console.log("ðŸ’¾ About to store credential in localStorage..."),t("Storing GitHub credential...");const x=JSON.parse(localStorage.getItem("credentials")||"[]");if(console.log("ðŸ“¦ Existing credentials count:",x.length),x.push(s),localStorage.setItem("credentials",JSON.stringify(x)),console.log("âœ… Credential stored! Total credentials now:",x.length),i("success"),t("GitHub developer credential created successfully!"),console.log("ðŸªŸ Window context check:",{hasOpener:!!window.opener,isPopup:window.opener!==null,parentIsSelf:window.parent===window}),window.opener){console.log("ðŸ“¨ Sending success message to parent window and closing popup..."),window.opener.postMessage({type:"GITHUB_OAUTH_SUCCESS",credential:s,username:s.credentialSubject?.username||"Unknown User"},window.location.origin),window.close();return}console.log("ðŸ”„ Same window OAuth - redirecting to credentials page in 2 seconds..."),setTimeout(()=>{console.log("ðŸ”„ Executing navigation to /credentials"),w("/credentials")},2e3)}catch(r){console.error("ðŸš¨ GitHub OAuth error details:",r),console.error("ðŸ” Full error object:",JSON.stringify(r,Object.getOwnPropertyNames(r))),i("error");let s="GitHub authentication failed";r instanceof Error&&(console.error("ðŸ” Error message:",r.message),console.error("ðŸ” Error stack:",r.stack),console.error("ðŸ” Error name:",r.name),y(r.message),r.message.includes("OAuth session not found")&&(console.error('ðŸ” FOUND THE CULPRIT! This is where "OAuth session not found" comes from'),console.error("ðŸ” Error came from GitHub service exchange method")),s=r.message),t(s)}}else i("error"),t(`${h} OAuth integration coming soon!`)}catch(a){T.logError("OAuth callback error:",a),i("error"),t("An unexpected error occurred")}},p=(()=>{switch(h){case"github":return{name:"GitHub",icon:"ðŸ™",color:"bg-gray-900"};case"linkedin":return{name:"LinkedIn",icon:"ðŸ’¼",color:"bg-blue-700"};case"plaid":return{name:"Plaid",icon:"ðŸ¦",color:"bg-green-600"};case"twitter":return{name:"X (Twitter)",icon:"ðŸ¦",color:"bg-black"};default:return{name:h,icon:"ðŸ”—",color:"bg-gray-600"}}})();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center p-4",children:e.jsxs(d.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center border-4 border-orange-500",children:[e.jsx(d.div,{animate:l==="loading"?{rotate:360}:{},transition:{duration:2,repeat:l==="loading"?1/0:0,ease:"linear"},className:`w-20 h-20 ${p.color} rounded-full flex items-center justify-center text-4xl text-white mx-auto mb-6 shadow-lg`,children:p.icon}),e.jsxs("div",{className:"mb-6",children:[l==="loading"&&e.jsxs(d.div,{animate:{opacity:[1,.5,1]},transition:{duration:1.5,repeat:1/0},className:"text-gray-700",children:[e.jsxs("div",{className:"text-2xl font-bold text-black mb-2",children:["Connecting ",p.name]}),e.jsx("div",{className:"flex justify-center space-x-2 mb-4",children:[0,1,2].map(a=>e.jsx(d.div,{animate:{scale:[1,1.2,1]},transition:{duration:.8,repeat:1/0,delay:a*.2},className:"w-3 h-3 bg-orange-500 rounded-full"},a))})]}),l==="success"&&e.jsxs(d.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"text-green-600",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âœ…"}),e.jsx("div",{className:"text-2xl font-bold text-black mb-2",children:"Success!"})]}),l==="error"&&e.jsxs(d.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"text-red-600",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âŒ"}),e.jsx("div",{className:"text-2xl font-bold text-black mb-2",children:"Error"})]})]}),e.jsx("div",{className:"text-gray-700 mb-6",children:j}),n&&e.jsxs("div",{className:"bg-gray-100 border border-gray-300 rounded-xl p-4 mb-6 text-left",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"ðŸ” OAuth Debug Information"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1 font-mono",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Code:"})," ",n.code]}),e.jsxs("div",{children:[e.jsx("strong",{children:"State:"})," ",n.state," (length: ",n.stateLength,")"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error:"})," ",n.error||"none"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Session State:"})," ",n.sessionState?`${n.sessionState.substring(0,10)}...`:"none"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Local State:"})," ",n.localState?`${n.localState.substring(0,10)}...`:"none"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"All Params:"})," ",JSON.stringify(n.allParams)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"URL:"})," ",n.url]}),f&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[e.jsx("strong",{className:"text-red-600",children:"Actual Error:"})," ",f]})})]})]}),l!=="loading"&&e.jsx(d.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},onClick:()=>w("/dashboard"),className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-8 py-3 rounded-xl font-semibold hover:from-orange-600 hover:to-orange-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:l==="success"?"Continue to Dashboard":"Try Again"}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-500",children:["Powered by"," ",e.jsx("span",{className:"font-bold bg-gradient-to-r from-orange-500 to-orange-600 bg-clip-text text-transparent",children:"PersonaPass"})]})})]})})};export{k as OAuthCallback};
