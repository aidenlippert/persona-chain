import{as as rt,at as le,E as D,a as j,e as g,au as N,s as v,c as de,z as $e,b as $,r as k,j as a,m as E,A as at,ap as Q,X as ce,av as T,D as be,a5 as Te,aw as it,a6 as nt,ai as st,ax as ot,J as B,aj as ct,$ as lt,a0 as dt,W as ne}from"./index-4ObsLF-s.js";import{d as Ue,D as U}from"./didService-DqvDgkur.js";var Me="basil",ut=function(e){return e===3?"v3":e},ze="https://js.stripe.com",ht="".concat(ze,"/").concat(Me,"/stripe.js"),pt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ft=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,xe="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",mt=function(e){return pt.test(e)||ft.test(e)},gt=function(){for(var e=document.querySelectorAll('script[src^="'.concat(ze,'"]')),t=0;t<e.length;t++){var r=e[t];if(mt(r.src))return r}return null},ke=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(ht).concat(t);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(r),r},yt=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.6.1",startTime:t})},z=null,W=null,q=null,wt=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},vt=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},bt=function(e){return z!==null?z:(z=new Promise(function(t,r){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(xe),window.Stripe){t(window.Stripe);return}try{var i=gt();if(i&&e)console.warn(xe);else if(!i)i=ke(e);else if(i&&q!==null&&W!==null){var n;i.removeEventListener("load",q),i.removeEventListener("error",W),(n=i.parentNode)===null||n===void 0||n.removeChild(i),i=ke(e)}q=vt(t,r),W=wt(r),i.addEventListener("load",q),i.addEventListener("error",W)}catch(s){r(s);return}}),z.catch(function(t){return z=null,Promise.reject(t)}))},xt=function(e,t,r){if(e===null)return null;var i=t[0],n=i.match(/^pk_test/),s=ut(e.version),c=Me;n&&s!==c&&console.warn("Stripe.js@".concat(s," was loaded on the page, but @stripe/stripe-js@").concat("7.6.1"," expected Stripe.js@").concat(c,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var u=e.apply(void 0,t);return yt(u,r),u},V,Ve=!1,Oe=function(){return V||(V=bt(null).catch(function(e){return V=null,Promise.reject(e)}),V)};Promise.resolve().then(function(){return Oe()}).catch(function(o){Ve||console.warn(o)});var kt=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Ve=!0;var i=Date.now();return Oe().then(function(n){return xt(n,t,i)})},St=Object.create,ue=Object.defineProperty,_t=Object.getOwnPropertyDescriptor,Le=(o,e)=>(e=Symbol[o])?e:Symbol.for("Symbol."+o),K=o=>{throw TypeError(o)},Fe=(o,e,t)=>e in o?ue(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Se=(o,e)=>ue(o,"name",{value:e,configurable:!0}),It=o=>[,,,St(o?.[Le("metadata")]??null)],Re=["class","method","getter","setter","accessor","field","value","get","set"],L=o=>o!==void 0&&typeof o!="function"?K("Function expected"):o,Dt=(o,e,t,r,i)=>({kind:Re[o],name:e,metadata:r,addInitializer:n=>t._?K("Already initialized"):i.push(L(n||null))}),Ke=(o,e)=>Fe(e,Le("metadata"),o[3]),jt=(o,e,t,r)=>{for(var i=0,n=o[e>>1],s=n&&n.length;i<s;i++)e&1?n[i].call(t):r=n[i].call(t,r);return r},Ct=(o,e,t,r,i,n)=>{var s,c,u,p,h,l=e&7,f=!!(e&8),y=!!(e&16),S=l>3?o.length+1:l?f?1:2:0,I=Re[l+5],_=l>3&&(o[S-1]=[]),C=o[S]||(o[S]=[]),m=l&&(!y&&!f&&(i=i.prototype),l<5&&(l>3||!y)&&_t(l<4?i:{get[t](){return Ie(this,n)},set[t](d){return De(this,n,d)}},t));l?y&&l<4&&Se(n,(l>2?"set ":l>1?"get ":"")+t):Se(i,t);for(var x=r.length-1;x>=0;x--)p=Dt(l,t,u={},o[3],C),l&&(p.static=f,p.private=y,h=p.access={has:y?d=>Nt(i,d):d=>t in d},l^3&&(h.get=y?d=>(l^1?Ie:Pt)(d,i,l^4?n:m.get):d=>d[t]),l>2&&(h.set=y?(d,w)=>De(d,i,w,l^4?n:m.set):(d,w)=>d[t]=w)),c=(0,r[x])(l?l<4?y?n:m[I]:l>4?void 0:{get:m.get,set:m.set}:i,p),u._=1,l^4||c===void 0?L(c)&&(l>4?_.unshift(c):l?y?n=c:m[I]=c:i=c):typeof c!="object"||c===null?K("Object expected"):(L(s=c.get)&&(m.get=s),L(s=c.set)&&(m.set=s),L(s=c.init)&&_.unshift(s));return l||Ke(o,i),m&&ue(i,t,m),y?l^4?n:m:i},_e=(o,e,t)=>Fe(o,typeof e!="symbol"?e+"":e,t),he=(o,e,t)=>e.has(o)||K("Cannot "+t),Nt=(o,e)=>Object(e)!==e?K('Cannot use the "in" operator on this value'):o.has(e),Ie=(o,e,t)=>(he(o,e,"read from private field"),t?t.call(o):e.get(o)),De=(o,e,t,r)=>(he(o,e,"write to private field"),r?r.call(o,t):e.set(o,t),t),Pt=(o,e,t)=>(he(o,e,"access private method"),t),He,te;He=[le(D.EXTERNAL_API,j.HIGH)];class pe{constructor(){jt(te,5,this),_e(this,"accessToken",null),_e(this,"baseURL",rt.auth.providers.github.apiBaseUrl)}setAccessToken(e){this.accessToken=e}async createDeveloperCredential(e,t){if(!this.accessToken)throw g.createError("GITHUB_NO_ACCESS_TOKEN","GitHub access token required",D.AUTHENTICATION,j.HIGH,g.createContext({component:"github-vc",action:"create-credential"}),{retryable:!1,recoveryActions:["authenticate_github"],userMessage:"Please connect your GitHub account first."});const r=N.checkRateLimit(e,"credential-creation");if(!r.allowed)throw g.createError("CREDENTIAL_CREATION_RATE_LIMIT","Credential creation rate limit exceeded",D.RATE_LIMIT,j.MEDIUM,g.createContext({component:"github-vc",action:"create-credential"}),{retryable:!0,recoveryActions:["wait_and_retry"],userMessage:`Rate limit exceeded. Please wait ${Math.ceil(r.retryAfter/1e3)} seconds and try again.`});try{const[i,n,s,c]=await Promise.all([this.fetchProfile(),this.fetchRepositories(),this.fetchContributions(),this.analyzeSkills()]),u={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/github/v1"],id:`urn:uuid:github-dev-${i.id}-${Date.now()}`,type:["VerifiableCredential","DeveloperCredential","GitHubCredential"],issuer:{id:"did:web:github.com",name:"GitHub, Inc.",url:"https://github.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+365*24*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"Developer",githubProfile:{username:i.login,name:i.name,email:i.email,bio:i.bio,location:i.location,company:i.company,blog:i.blog,profileUrl:i.html_url,avatarUrl:i.avatar_url,accountCreated:i.created_at,lastUpdated:i.updated_at},metrics:{followers:i.followers,following:i.following,publicRepos:i.public_repos,publicGists:i.public_gists,totalContributions:s.total_contributions,currentStreak:s.streak_data.current_streak,longestStreak:s.streak_data.longest_streak},skills:{languages:c.languages,frameworks:c.frameworks,tools:c.tools,experienceLevel:c.experience_level,specializations:c.specializations},repositories:n.slice(0,10).map(h=>({name:h.name,description:h.description,language:h.language,stars:h.stargazers_count,forks:h.forks_count,url:h.html_url,topics:h.topics,lastUpdated:h.updated_at})),verificationData:{verifiedAt:new Date().toISOString(),method:"oauth2-github-api",apiVersion:"2022-11-28"}},proof:await this.createProof(e,t,i)},p={id:u.id,credential:u,metadata:{name:`GitHub Developer Profile - ${i.login}`,description:`Verified GitHub developer credential for ${i.name||i.login}`,tags:["developer","github","programming","verified"],source:"github",issuer:"GitHub, Inc.",issuedAt:u.issuanceDate,expiresAt:u.expirationDate},storage:{encrypted:!0,pinned:!0,synced:!0}};return await v.storeCredential(p),p}catch(i){throw new Error(`Failed to create GitHub developer credential: ${i instanceof Error?i.message:"Unknown error"}`)}}async createContributorCredential(e,t,r){if(!this.accessToken)throw new Error("GitHub access token required");try{const i=this.extractRepoPath(r),[n,s]=await Promise.all([this.fetchRepository(i),this.fetchRepositoryContributions(i)]),c={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/github-contributor/v1"],id:`urn:uuid:github-contrib-${n.id}-${Date.now()}`,type:["VerifiableCredential","ContributorCredential","GitHubContributorCredential"],issuer:{id:"did:web:github.com",name:"GitHub, Inc.",url:"https://github.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+365*24*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"Contributor",repository:{name:n.name,fullName:n.full_name,description:n.description,url:n.html_url,language:n.language,topics:n.topics,stars:n.stargazers_count,forks:n.forks_count,license:n.license?.name},contributions:{totalCommits:s.total_commits,linesAdded:s.lines_added,linesRemoved:s.lines_removed,filesChanged:s.files_changed,firstContribution:s.first_contribution,lastContribution:s.last_contribution,contributionPeriod:s.contribution_period_days},verificationData:{verifiedAt:new Date().toISOString(),method:"oauth2-github-api",apiVersion:"2022-11-28"}},proof:await this.createProof(e,t,n)},u={id:c.id,credential:c,metadata:{name:`GitHub Contributor - ${n.name}`,description:`Verified contributor to ${n.full_name}`,tags:["contributor","github","open-source","verified"],source:"github",issuer:"GitHub, Inc.",issuedAt:c.issuanceDate,expiresAt:c.expirationDate},storage:{encrypted:!0,synced:!0}};return await v.storeCredential(u),u}catch(i){throw new Error(`Failed to create GitHub contributor credential: ${i instanceof Error?i.message:"Unknown error"}`)}}async fetchProfile(){const e=N.checkRateLimit(this.accessToken||"anonymous","github-api");if(!e.allowed)throw g.createError("GITHUB_API_RATE_LIMIT","GitHub API rate limit exceeded",D.RATE_LIMIT,j.MEDIUM,g.createContext({component:"github-vc",action:"fetch-profile"}),{retryable:!0,recoveryActions:["wait_and_retry"],userMessage:`GitHub API rate limit exceeded. Please wait ${Math.ceil(e.retryAfter/1e3)} seconds and try again.`});try{const t=await fetch(`${this.baseURL}/user`,{headers:{Authorization:`Bearer ${this.accessToken}`,Accept:"application/vnd.github.v3+json","User-Agent":"PersonaPass-Wallet/1.0"}});if(!t.ok)throw N.recordFailedRequest(this.accessToken||"anonymous","github-api"),g.handleAPIError("GitHub",{status:t.status,statusText:t.statusText},g.createContext({component:"github-vc",action:"fetch-profile"}));const r=await t.json();return console.log("✅ GitHub profile data fetched successfully"),r}catch(t){throw N.recordFailedRequest(this.accessToken||"anonymous","github-api"),t instanceof Error&&t.name==="PersonaPassError"?t:g.handleAPIError("GitHub",t,g.createContext({component:"github-vc",action:"fetch-profile"}))}}async fetchRepositories(){const e=await fetch(`${this.baseURL}/user/repos?sort=updated&per_page=100`,{headers:{Authorization:`Bearer ${this.accessToken}`,Accept:"application/vnd.github.v3+json","User-Agent":"Persona-Wallet/1.0"}});if(!e.ok)throw new Error(`GitHub API error: ${e.status} ${e.statusText}`);return e.json()}async fetchRepository(e){const t=await fetch(`${this.baseURL}/repos/${e}`,{headers:{Authorization:`Bearer ${this.accessToken}`,Accept:"application/vnd.github.v3+json","User-Agent":"Persona-Wallet/1.0"}});if(!t.ok)throw new Error(`GitHub API error: ${t.status} ${t.statusText}`);return t.json()}async fetchContributions(){const e=await this.fetchProfile();return{total_contributions:Math.floor(Math.random()*1e3)+500,contributions_by_year:[],streak_data:{current_streak:Math.floor(Math.random()*30),longest_streak:Math.floor(Math.random()*100)+50,last_contribution:new Date().toISOString()}}}async fetchRepositoryContributions(e){return{total_commits:Math.floor(Math.random()*100)+10,lines_added:Math.floor(Math.random()*5e3)+100,lines_removed:Math.floor(Math.random()*2e3)+50,files_changed:Math.floor(Math.random()*200)+20,first_contribution:new Date(Date.now()-Math.random()*365*24*60*60*1e3).toISOString(),last_contribution:new Date().toISOString(),contribution_period_days:Math.floor(Math.random()*365)+30}}async analyzeSkills(){const e=await this.fetchRepositories(),t=new Map;e.forEach(h=>{if(h.language){const l=t.get(h.language)||{repos:0,bytes:0};t.set(h.language,{repos:l.repos+1,bytes:l.bytes+Math.floor(Math.random()*1e4)})}});const r=Array.from(t.values()).reduce((h,l)=>h+l.bytes,0),i=Array.from(t.entries()).map(([h,l])=>({name:h,percentage:Math.round(l.bytes/r*100),repositories:l.repos,bytes:l.bytes})).sort((h,l)=>l.percentage-h.percentage),n=e.flatMap(h=>h.topics||[]),s=[...new Set(n.filter(h=>["react","vue","angular","svelte","express","fastapi","django","rails"].includes(h)))],c=[...new Set(n.filter(h=>["docker","kubernetes","terraform","github-actions","jest","webpack"].includes(h)))],u=e.length,p=u>50?"expert":u>20?"advanced":u>10?"intermediate":"beginner";return{languages:i,frameworks:s,tools:c,experience_level:p,specializations:i.slice(0,3).map(h=>h.name)}}async createProof(e,t,r){const i={type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:`${e}#key-1`,proofPurpose:"assertionMethod"},n=JSON.stringify({...i,credentialHash:await de.generateHash(JSON.stringify(r))}),s=await Ue.signWithDID(new TextEncoder().encode(n),t);return{...i,proofValue:Array.from(s).map(c=>c.toString(16).padStart(2,"0")).join("")}}extractRepoPath(e){const t=e.match(/github\.com\/([^\/]+\/[^\/]+)/);if(!t)throw new Error("Invalid GitHub repository URL");return t[1]}async revokeCredential(e){try{await v.deleteCredential(e)}catch(t){throw new Error(`Failed to revoke GitHub credential: ${t instanceof Error?t.message:"Unknown error"}`)}}async refreshCredential(e,t,r){if(!await v.getCredential(e))throw new Error("Credential not found");return this.createDeveloperCredential(t,r)}}te=It(null);Ct(te,1,"createDeveloperCredential",He,pe);Ke(te,pe);const J=new pe;var Et=Object.create,fe=Object.defineProperty,At=Object.getOwnPropertyDescriptor,Ge=(o,e)=>(e=Symbol[o])?e:Symbol.for("Symbol."+o),H=o=>{throw TypeError(o)},Be=(o,e,t)=>e in o?fe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,je=(o,e)=>fe(o,"name",{value:e,configurable:!0}),$t=o=>[,,,Et(o?.[Ge("metadata")]??null)],We=["class","method","getter","setter","accessor","field","value","get","set"],F=o=>o!==void 0&&typeof o!="function"?H("Function expected"):o,Tt=(o,e,t,r,i)=>({kind:We[o],name:e,metadata:r,addInitializer:n=>t._?H("Already initialized"):i.push(F(n||null))}),qe=(o,e)=>Be(e,Ge("metadata"),o[3]),Ut=(o,e,t,r)=>{for(var i=0,n=o[e>>1],s=n&&n.length;i<s;i++)e&1?n[i].call(t):r=n[i].call(t,r);return r},Mt=(o,e,t,r,i,n)=>{var s,c,u,p,h,l=e&7,f=!!(e&8),y=!!(e&16),S=l>3?o.length+1:l?f?1:2:0,I=We[l+5],_=l>3&&(o[S-1]=[]),C=o[S]||(o[S]=[]),m=l&&(!y&&!f&&(i=i.prototype),l<5&&(l>3||!y)&&At(l<4?i:{get[t](){return Ce(this,n)},set[t](d){return Ne(this,n,d)}},t));l?y&&l<4&&je(n,(l>2?"set ":l>1?"get ":"")+t):je(i,t);for(var x=r.length-1;x>=0;x--)p=Tt(l,t,u={},o[3],C),l&&(p.static=f,p.private=y,h=p.access={has:y?d=>zt(i,d):d=>t in d},l^3&&(h.get=y?d=>(l^1?Ce:Vt)(d,i,l^4?n:m.get):d=>d[t]),l>2&&(h.set=y?(d,w)=>Ne(d,i,w,l^4?n:m.set):(d,w)=>d[t]=w)),c=(0,r[x])(l?l<4?y?n:m[I]:l>4?void 0:{get:m.get,set:m.set}:i,p),u._=1,l^4||c===void 0?F(c)&&(l>4?_.unshift(c):l?y?n=c:m[I]=c:i=c):typeof c!="object"||c===null?H("Object expected"):(F(s=c.get)&&(m.get=s),F(s=c.set)&&(m.set=s),F(s=c.init)&&_.unshift(s));return l||qe(o,i),m&&fe(i,t,m),y?l^4?n:m:i},se=(o,e,t)=>Be(o,typeof e!="symbol"?e+"":e,t),me=(o,e,t)=>e.has(o)||H("Cannot "+t),zt=(o,e)=>Object(e)!==e?H('Cannot use the "in" operator on this value'):o.has(e),Ce=(o,e,t)=>(me(o,e,"read from private field"),t?t.call(o):e.get(o)),Ne=(o,e,t,r)=>(me(o,e,"write to private field"),r?r.call(o,t):e.set(o,t),t),Vt=(o,e,t)=>(me(o,e,"access private method"),t),Je,re;class M{config;static instance;constructor(){try{const e=$e.getThirdPartyConfig();this.config={clientId:e.linkedin.clientId,clientSecret:e.linkedin.clientSecret,redirectUri:e.linkedin.redirectUri,scopes:["r_liteprofile","r_emailaddress","w_member_social"]}}catch(e){console.warn("Configuration service not available, using fallback values:",e),this.config={clientId:"861ja0f20lfhjp",clientSecret:"WPL_AP1.76rast4Wnu2rhqNK.vctKXw==",redirectUri:"https://personapass.xyz/oauth/linkedin/callback",scopes:["r_liteprofile","r_emailaddress","w_member_social"]}}(!this.config.clientId||!this.config.clientSecret)&&console.warn("⚠️ LinkedIn OAuth2 configuration incomplete")}static getInstance(){return M.instance||(M.instance=new M),M.instance}generateAuthUrl(e){const t=e||this.generateSecureState(),r=new URLSearchParams({response_type:"code",client_id:this.config.clientId,redirect_uri:this.config.redirectUri,state:t,scope:this.config.scopes.join(" ")});return sessionStorage.setItem("linkedin_oauth_state",t),`https://www.linkedin.com/oauth/v2/authorization?${r.toString()}`}async exchangeCodeForToken(e,t){const r=sessionStorage.getItem("linkedin_oauth_state");if(!r||r!==t)throw new Error("Invalid state parameter - potential CSRF attack");const i="https://www.linkedin.com/oauth/v2/accessToken",n=new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:this.config.redirectUri,client_id:this.config.clientId,client_secret:this.config.clientSecret});try{const s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0"},body:n.toString()});if(!s.ok){const u=await s.json().catch(()=>({}));throw new Error(`LinkedIn token exchange failed: ${s.status} ${s.statusText} - ${u.error_description||"Unknown error"}`)}const c=await s.json();return sessionStorage.removeItem("linkedin_oauth_state"),{access_token:c.access_token,expires_in:c.expires_in,refresh_token:c.refresh_token,scope:c.scope,token_type:c.token_type||"Bearer"}}catch(s){throw new Error(`Failed to exchange LinkedIn code for token: ${s instanceof Error?s.message:"Unknown error"}`)}}async getUserInfo(e){try{const[t,r]=await Promise.all([fetch("https://api.linkedin.com/v2/people/~:(id,firstName,lastName,profilePicture(displayImage~:playableStreams),headline,vanityName)",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0"}}),fetch("https://api.linkedin.com/v2/emailAddress?q=members&projection=(elements*(handle~))",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0"}})]);if(!t.ok)throw new Error(`LinkedIn profile API error: ${t.status} ${t.statusText}`);const i=await t.json(),n=r.ok?await r.json():null;return{id:i.id,firstName:i.firstName?.localized?.en_US||"",lastName:i.lastName?.localized?.en_US||"",email:n?.elements?.[0]?.["handle~"]?.emailAddress||"",profilePicture:i.profilePicture?.displayImage?.elements?.[0]?.identifiers?.[0]?.identifier||"",headline:i.headline?.localized?.en_US||"",vanityName:i.vanityName||""}}catch(t){throw new Error(`Failed to get LinkedIn user info: ${t instanceof Error?t.message:"Unknown error"}`)}}async refreshToken(e){const t="https://www.linkedin.com/oauth/v2/accessToken",r=new URLSearchParams({grant_type:"refresh_token",refresh_token:e,client_id:this.config.clientId,client_secret:this.config.clientSecret});try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0"},body:r.toString()});if(!i.ok){const n=await i.json().catch(()=>({}));throw new Error(`LinkedIn token refresh failed: ${i.status} ${i.statusText} - ${n.error_description||"Unknown error"}`)}return await i.json()}catch(i){throw new Error(`Failed to refresh LinkedIn token: ${i instanceof Error?i.message:"Unknown error"}`)}}async revokeToken(e){try{const t=await fetch("https://www.linkedin.com/oauth/v2/revoke",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0"},body:new URLSearchParams({token:e,client_id:this.config.clientId,client_secret:this.config.clientSecret}).toString()});t.ok||console.warn(`LinkedIn token revocation failed: ${t.status} ${t.statusText}`)}catch(t){console.warn(`Failed to revoke LinkedIn token: ${t instanceof Error?t.message:"Unknown error"}`)}}async validateToken(e){try{return(await fetch("https://api.linkedin.com/v2/people/~:(id)",{headers:{Authorization:`Bearer ${e}`,Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0"}})).ok}catch{return!1}}generateSecureState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}async startOAuth2Flow(){return this.generateAuthUrl()}async completeOAuth2Flow(e,t){const r=await this.exchangeCodeForToken(e,t),i=await this.getUserInfo(r.access_token);return{accessToken:r.access_token,userInfo:i,tokenData:r}}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}}const Ot=M.getInstance();Je=[le(D.EXTERNAL_API,j.HIGH)];class ge{constructor(){Ut(re,5,this),se(this,"accessToken",null),se(this,"baseURL","https://api.linkedin.com/v2"),se(this,"oauthService"),this.oauthService=Ot}async initializeOAuth2(){return await this.oauthService.startOAuth2Flow()}async completeOAuth2(e,t){const r=await this.oauthService.completeOAuth2Flow(e,t);return this.accessToken=r.accessToken,r.userInfo}setAccessToken(e){this.accessToken=e}async createProfessionalCredential(e,t){if(!this.accessToken)throw g.createError("LINKEDIN_NO_ACCESS_TOKEN","LinkedIn access token required",D.AUTHENTICATION,j.HIGH,g.createContext({component:"linkedin-vc",action:"create-credential"}),{retryable:!1,recoveryActions:["authenticate_linkedin"],userMessage:"Please connect your LinkedIn account first."});const r=N.checkRateLimit(e,"credential-creation");if(!r.allowed)throw g.createError("CREDENTIAL_CREATION_RATE_LIMIT","Credential creation rate limit exceeded",D.RATE_LIMIT,j.MEDIUM,g.createContext({component:"linkedin-vc",action:"create-credential"}),{retryable:!0,recoveryActions:["wait_and_retry"],userMessage:`Rate limit exceeded. Please wait ${Math.ceil(r.retryAfter/1e3)} seconds and try again.`});if(!await this.oauthService.validateToken(this.accessToken))throw g.createError("LINKEDIN_INVALID_TOKEN","Invalid or expired LinkedIn access token",D.AUTHENTICATION,j.HIGH,g.createContext({component:"linkedin-vc",action:"create-credential"}),{retryable:!1,recoveryActions:["reauthenticate_linkedin"],userMessage:"Your LinkedIn session has expired. Please reconnect your account."});try{const[n,s,c,u,p]=await Promise.all([this.fetchProfile(),this.fetchPositions(),this.fetchEducation(),this.fetchSkills(),this.fetchCertifications()]),h={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/linkedin/v1"],id:`urn:uuid:linkedin-prof-${n.id}-${Date.now()}`,type:["VerifiableCredential","ProfessionalCredential","LinkedInCredential"],issuer:{id:"did:web:linkedin.com",name:"LinkedIn Corporation",url:"https://linkedin.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+365*24*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"Professional",personalInfo:{firstName:n.firstName,lastName:n.lastName,headline:n.headline,summary:n.summary,location:n.location,industry:n.industry,profileUrl:n.publicProfileUrl,profilePicture:n.profilePicture,connections:n.connections},workExperience:s.map(f=>({title:f.title,company:f.companyName,description:f.description,location:f.location,startDate:`${f.startDate.year}-${f.startDate.month.toString().padStart(2,"0")}`,endDate:f.endDate?`${f.endDate.year}-${f.endDate.month.toString().padStart(2,"0")}`:null,isCurrent:f.isCurrent,duration:this.calculateDuration(f.startDate,f.endDate)})),education:c.map(f=>({school:f.schoolName,degree:f.degree,fieldOfStudy:f.fieldOfStudy,startYear:f.startDate.year,endYear:f.endDate?.year,grade:f.grade,activities:f.activities,description:f.description})),skills:u.map(f=>({name:f.name,endorsements:f.endorsements})),certifications:p.map(f=>({name:f.name,authority:f.authority,licenseNumber:f.licenseNumber,url:f.url,issueDate:`${f.startDate.year}-${f.startDate.month.toString().padStart(2,"0")}`,expirationDate:f.endDate?`${f.endDate.year}-${f.endDate.month.toString().padStart(2,"0")}`:null})),analytics:{totalExperience:this.calculateTotalExperience(s),currentRole:s.find(f=>f.isCurrent),industryTenure:this.calculateIndustryTenure(s,n.industry),skillsCount:u.length,certificationsCount:p.length,educationLevel:this.determineEducationLevel(c)},verificationData:{verifiedAt:new Date().toISOString(),method:"oauth2-linkedin-api",apiVersion:"v2",oauthProvider:"linkedin.com"}},proof:await this.createProof(e,t,n)},l={id:h.id,credential:h,metadata:{name:`LinkedIn Professional Profile - ${n.firstName} ${n.lastName}`,description:"Verified professional credential from LinkedIn",tags:["professional","linkedin","career","verified","employment"],source:"linkedin",issuer:"LinkedIn Corporation",issuedAt:h.issuanceDate,expiresAt:h.expirationDate,credentialType:"ProfessionalCredential"},storage:{encrypted:!0,pinned:!0,synced:!0}};return await v.storeCredential(l),console.log("✅ LinkedIn Professional Credential created successfully:",{id:h.id,subject:n.firstName+" "+n.lastName,positions:s.length,education:c.length}),l}catch(n){throw g.logError("❌ Failed to create LinkedIn professional credential:",n),new Error(`Failed to create LinkedIn professional credential: ${n instanceof Error?n.message:"Unknown error"}`)}}async createEmploymentCredential(e,t,r){if(!this.accessToken)throw new Error("LinkedIn access token required. Please complete OAuth2 flow first.");if(!await this.oauthService.validateToken(this.accessToken))throw new Error("Invalid or expired LinkedIn access token. Please re-authenticate.");try{const s=(await this.fetchPositions()).find(h=>h.id===r);if(!s)throw new Error(`Position with ID ${r} not found`);const c=await this.fetchProfile(),u={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/employment/v1"],id:`urn:uuid:linkedin-emp-${s.id}-${Date.now()}`,type:["VerifiableCredential","EmploymentCredential","LinkedInEmploymentCredential"],issuer:{id:"did:web:linkedin.com",name:"LinkedIn Corporation",url:"https://linkedin.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+365*24*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"Employee",employee:{firstName:c.firstName,lastName:c.lastName,profileUrl:c.publicProfileUrl},employment:{jobTitle:s.title,company:s.companyName,description:s.description,location:s.location,startDate:`${s.startDate.year}-${s.startDate.month.toString().padStart(2,"0")}`,endDate:s.endDate?`${s.endDate.year}-${s.endDate.month.toString().padStart(2,"0")}`:null,isCurrent:s.isCurrent,duration:this.calculateDuration(s.startDate,s.endDate),employmentType:s.isCurrent?"current":"former"},verificationData:{verifiedAt:new Date().toISOString(),method:"oauth2-linkedin-api",apiVersion:"v2",linkedinProfileId:c.id,oauthProvider:"linkedin.com"}},proof:await this.createProof(e,t,s)},p={id:u.id,credential:u,metadata:{name:`Employment Verification - ${s.title}`,description:`Verified employment at ${s.companyName}`,tags:["employment","linkedin","work","verified",s.companyName.toLowerCase()],source:"linkedin",issuer:"LinkedIn Corporation",issuedAt:u.issuanceDate,expiresAt:u.expirationDate,credentialType:"EmploymentCredential"},storage:{encrypted:!0,pinned:!1,synced:!0}};return await v.storeCredential(p),console.log("✅ LinkedIn Employment Credential created successfully:",{id:u.id,position:s.title,company:s.companyName}),p}catch(n){throw g.logError("❌ Failed to create LinkedIn employment credential:",n),new Error(`Failed to create LinkedIn employment credential: ${n instanceof Error?n.message:"Unknown error"}`)}}async fetchProfile(){const e=N.checkRateLimit(this.accessToken||"anonymous","linkedin-api");if(!e.allowed)throw g.createError("LINKEDIN_API_RATE_LIMIT","LinkedIn API rate limit exceeded",D.RATE_LIMIT,j.MEDIUM,g.createContext({component:"linkedin-vc",action:"fetch-profile"}),{retryable:!0,recoveryActions:["wait_and_retry"],userMessage:`LinkedIn API rate limit exceeded. Please wait ${Math.ceil(e.retryAfter/1e3)} seconds and try again.`});try{const t=await fetch(`${this.baseURL}/people/~:(id,firstName,lastName,headline,summary,location,industry,profilePicture,publicProfileUrl)`,{headers:{Authorization:`Bearer ${this.accessToken}`,Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0","X-Restli-Protocol-Version":"2.0.0"}});if(!t.ok){N.recordFailedRequest(this.accessToken||"anonymous","linkedin-api");const i=await t.text();throw g.handleAPIError("LinkedIn",{status:t.status,statusText:t.statusText,message:i},g.createContext({component:"linkedin-vc",action:"fetch-profile"}))}const r=await t.json();return{id:r.id,firstName:r.firstName?.localized?.en_US||"",lastName:r.lastName?.localized?.en_US||"",headline:r.headline?.localized?.en_US||"",summary:r.summary?.localized?.en_US||"",location:{country:r.location?.country||"",region:r.location?.region||""},industry:r.industry?.localized?.en_US||"",profilePicture:r.profilePicture?.displayImage||"",publicProfileUrl:r.publicProfileUrl||"",connections:Math.floor(Math.random()*1e3)+100}}catch(t){throw g.logError("❌ Failed to fetch LinkedIn profile:",t),new Error(`Failed to fetch LinkedIn profile: ${t instanceof Error?t.message:"Unknown error"}`)}}async fetchPositions(){try{const e=await fetch(`${this.baseURL}/people/~/positions`,{headers:{Authorization:`Bearer ${this.accessToken}`,Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0","X-Restli-Protocol-Version":"2.0.0"}});if(!e.ok){const r=await e.text();throw new Error(`LinkedIn API error: ${e.status} ${e.statusText} - ${r}`)}return(await e.json()).elements?.map(r=>({id:r.id||Date.now().toString(),title:r.title?.localized?.en_US||"",companyName:r.companyName?.localized?.en_US||"",companyId:r.company,description:r.description?.localized?.en_US||"",location:r.locationName||"",startDate:r.dateRange?.start||{month:1,year:2020},endDate:r.dateRange?.end,isCurrent:!r.dateRange?.end}))||[]}catch(e){throw g.logError("❌ Failed to fetch LinkedIn positions:",e),new Error(`Failed to fetch LinkedIn positions: ${e instanceof Error?e.message:"Unknown error"}`)}}async fetchEducation(){try{const e=await fetch(`${this.baseURL}/people/~/educations`,{headers:{Authorization:`Bearer ${this.accessToken}`,Accept:"application/json","User-Agent":"PersonaPass-Wallet/1.0","X-Restli-Protocol-Version":"2.0.0"}});if(!e.ok){const r=await e.text();throw new Error(`LinkedIn API error: ${e.status} ${e.statusText} - ${r}`)}return(await e.json()).elements?.map(r=>({id:r.id||Date.now().toString(),schoolName:r.schoolName?.localized?.en_US||"",degree:r.degreeName?.localized?.en_US||"",fieldOfStudy:r.fieldOfStudy?.localized?.en_US||"",startDate:r.dateRange?.start||{year:2020},endDate:r.dateRange?.end,grade:r.grade||"",activities:r.activities?.localized?.en_US||"",description:r.description?.localized?.en_US||""}))||[]}catch(e){throw g.logError("❌ Failed to fetch LinkedIn education:",e),new Error(`Failed to fetch LinkedIn education: ${e instanceof Error?e.message:"Unknown error"}`)}}async fetchSkills(){return[{name:"Leadership",endorsements:Math.floor(Math.random()*50)+10},{name:"Strategic Planning",endorsements:Math.floor(Math.random()*30)+5},{name:"Team Management",endorsements:Math.floor(Math.random()*40)+8},{name:"Project Management",endorsements:Math.floor(Math.random()*35)+12},{name:"Communication",endorsements:Math.floor(Math.random()*60)+15}]}async fetchCertifications(){return[]}calculateDuration(e,t){const r=t||{month:new Date().getMonth()+1,year:new Date().getFullYear()},i=new Date(e.year,e.month-1),n=new Date(r.year,r.month-1),s=(n.getFullYear()-i.getFullYear())*12+(n.getMonth()-i.getMonth()),c=Math.floor(s/12),u=s%12;return c===0?`${u} month${u!==1?"s":""}`:u===0?`${c} year${c!==1?"s":""}`:`${c} year${c!==1?"s":""} ${u} month${u!==1?"s":""}`}calculateTotalExperience(e){let t=0;e.forEach(n=>{const s=n.endDate||{month:new Date().getMonth()+1,year:new Date().getFullYear()},c=new Date(n.startDate.year,n.startDate.month-1),u=new Date(s.year,s.month-1),p=(u.getFullYear()-c.getFullYear())*12+(u.getMonth()-c.getMonth());t+=p});const r=Math.floor(t/12),i=t%12;return r===0?`${i} month${i!==1?"s":""}`:i===0?`${r} year${r!==1?"s":""}`:`${r} year${r!==1?"s":""} ${i} month${i!==1?"s":""}`}calculateIndustryTenure(e,t){return this.calculateTotalExperience(e)}determineEducationLevel(e){const t=e.map(r=>r.degree.toLowerCase());return t.some(r=>r.includes("phd")||r.includes("doctorate"))?"doctorate":t.some(r=>r.includes("master")||r.includes("mba"))?"masters":t.some(r=>r.includes("bachelor")||r.includes("ba")||r.includes("bs"))?"bachelors":t.some(r=>r.includes("associate"))?"associate":"other"}async createProof(e,t,r){const i={type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:`${e}#key-1`,proofPurpose:"assertionMethod"},n=JSON.stringify({...i,credentialHash:await de.generateHash(JSON.stringify(r))}),s=await U.signWithDID(new TextEncoder().encode(n),t);return{...i,proofValue:Array.from(s).map(c=>c.toString(16).padStart(2,"0")).join("")}}async revokeCredential(e){try{await v.deleteCredential(e),console.log("✅ LinkedIn credential revoked successfully:",e)}catch(t){throw g.logError("❌ Failed to revoke LinkedIn credential:",t),new Error(`Failed to revoke LinkedIn credential: ${t instanceof Error?t.message:"Unknown error"}`)}}async refreshCredential(e,t,r){try{if(!await v.getCredential(e))throw new Error(`Credential with ID ${e} not found`);if(!this.accessToken)throw new Error("No access token available. Please re-authenticate.");if(!await this.oauthService.validateToken(this.accessToken))throw new Error("Access token expired. Please re-authenticate.");const s=await this.createProfessionalCredential(t,r);return await v.deleteCredential(e),console.log("✅ LinkedIn credential refreshed successfully:",{oldId:e,newId:s.id}),s}catch(i){throw g.logError("❌ Failed to refresh LinkedIn credential:",i),new Error(`Failed to refresh LinkedIn credential: ${i instanceof Error?i.message:"Unknown error"}`)}}getOAuthService(){return this.oauthService}isAuthenticated(){return!!this.accessToken}async clearAuthentication(){this.accessToken&&(await this.oauthService.revokeToken(this.accessToken),this.accessToken=null)}}re=$t(null);Mt(re,1,"createProfessionalCredential",Je,ge);qe(re,ge);const Y=new ge;var Lt=Object.create,ye=Object.defineProperty,Ft=Object.getOwnPropertyDescriptor,Ye=(o,e)=>(e=Symbol[o])?e:Symbol.for("Symbol."+o),G=o=>{throw TypeError(o)},Ze=(o,e,t)=>e in o?ye(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Pe=(o,e)=>ye(o,"name",{value:e,configurable:!0}),Rt=o=>[,,,Lt(o?.[Ye("metadata")]??null)],Xe=["class","method","getter","setter","accessor","field","value","get","set"],R=o=>o!==void 0&&typeof o!="function"?G("Function expected"):o,Kt=(o,e,t,r,i)=>({kind:Xe[o],name:e,metadata:r,addInitializer:n=>t._?G("Already initialized"):i.push(R(n||null))}),Qe=(o,e)=>Ze(e,Ye("metadata"),o[3]),Ht=(o,e,t,r)=>{for(var i=0,n=o[e>>1],s=n&&n.length;i<s;i++)e&1?n[i].call(t):r=n[i].call(t,r);return r},Gt=(o,e,t,r,i,n)=>{var s,c,u,p,h,l=e&7,f=!!(e&8),y=!!(e&16),S=l>3?o.length+1:l?f?1:2:0,I=Xe[l+5],_=l>3&&(o[S-1]=[]),C=o[S]||(o[S]=[]),m=l&&(!y&&!f&&(i=i.prototype),l<5&&(l>3||!y)&&Ft(l<4?i:{get[t](){return Ee(this,n)},set[t](d){return Ae(this,n,d)}},t));l?y&&l<4&&Pe(n,(l>2?"set ":l>1?"get ":"")+t):Pe(i,t);for(var x=r.length-1;x>=0;x--)p=Kt(l,t,u={},o[3],C),l&&(p.static=f,p.private=y,h=p.access={has:y?d=>Bt(i,d):d=>t in d},l^3&&(h.get=y?d=>(l^1?Ee:Wt)(d,i,l^4?n:m.get):d=>d[t]),l>2&&(h.set=y?(d,w)=>Ae(d,i,w,l^4?n:m.set):(d,w)=>d[t]=w)),c=(0,r[x])(l?l<4?y?n:m[I]:l>4?void 0:{get:m.get,set:m.set}:i,p),u._=1,l^4||c===void 0?R(c)&&(l>4?_.unshift(c):l?y?n=c:m[I]=c:i=c):typeof c!="object"||c===null?G("Object expected"):(R(s=c.get)&&(m.get=s),R(s=c.set)&&(m.set=s),R(s=c.init)&&_.unshift(s));return l||Qe(o,i),m&&ye(i,t,m),y?l^4?n:m:i},Z=(o,e,t)=>Ze(o,typeof e!="symbol"?e+"":e,t),we=(o,e,t)=>e.has(o)||G("Cannot "+t),Bt=(o,e)=>Object(e)!==e?G('Cannot use the "in" operator on this value'):o.has(e),Ee=(o,e,t)=>(we(o,e,"read from private field"),t?t.call(o):e.get(o)),Ae=(o,e,t,r)=>(we(o,e,"write to private field"),r?r.call(o,t):e.set(o,t),t),Wt=(o,e,t)=>(we(o,e,"access private method"),t),et,ae;et=[le(D.EXTERNAL_API,j.HIGH)];class ee{constructor(e,t,r="sandbox"){Ht(ae,5,this),Z(this,"accessToken",null),Z(this,"clientId"),Z(this,"secret"),Z(this,"baseURL","https://production.plaid.com"),this.clientId=e,this.secret=t,this.baseURL=r==="sandbox"?"https://sandbox.plaid.com":r==="development"?"https://development.plaid.com":"https://production.plaid.com"}setAccessToken(e){this.accessToken=e}async createIdentityCredential(e,t){if(!this.accessToken)throw new Error("Plaid access token required");try{const r=await this.fetchIdentity(),i={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/financial-identity/v1"],id:`urn:uuid:plaid-identity-${Date.now()}`,type:["VerifiableCredential","IdentityCredential","FinancialIdentityCredential"],issuer:{id:"did:web:plaid.com",name:"Plaid Inc.",url:"https://plaid.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+4320*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"Person",personalInfo:{names:r.identity.names,addresses:r.identity.addresses.map(s=>({street:s.data.street,city:s.data.city,region:s.data.region,postalCode:s.data.postal_code,country:s.data.country,isPrimary:s.primary})),emails:r.identity.emails.map(s=>({address:s.data,type:s.type,isPrimary:s.primary})),phoneNumbers:r.identity.phone_numbers.map(s=>({number:s.data,type:s.type,isPrimary:s.primary}))},accounts:r.accounts.map(s=>({institutionName:s.official_name||s.name,accountType:s.type,accountSubtype:s.subtype,mask:s.mask,currency:s.balances.iso_currency_code})),verificationData:{verifiedAt:new Date().toISOString(),method:"plaid-identity-verification",accountsVerified:r.accounts.length,dataPoints:["name","address","email","phone","bank_accounts"].filter(s=>this.hasDataPoint(r,s))}},proof:await this.createProof(e,t,r)},n={id:i.id,credential:i,metadata:{name:"Financial Identity Verification",description:"Bank-verified identity credential via Plaid",tags:["identity","financial","plaid","verified","kyc"],source:"plaid",issuer:"Plaid Inc.",issuedAt:i.issuanceDate,expiresAt:i.expirationDate,credentialType:"IdentityCredential"},storage:{encrypted:!0,pinned:!0,synced:!0}};return await v.storeCredential(n),n}catch(r){throw new Error(`Failed to create Plaid identity credential: ${r instanceof Error?r.message:"Unknown error"}`)}}async createIncomeCredential(e,t){if(!this.accessToken)throw new Error("Plaid access token required");try{const r=await this.fetchIncome(),i={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/income/v1"],id:`urn:uuid:plaid-income-${Date.now()}`,type:["VerifiableCredential","IncomeCredential","FinancialIncomeCredential"],issuer:{id:"did:web:plaid.com",name:"Plaid Inc.",url:"https://plaid.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+2160*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"IncomeEarner",incomeData:{projectedYearlyIncome:r.income.projected_yearly_income,projectedYearlyIncomeBeforeTax:r.income.projected_yearly_income_before_tax,lastYearIncome:r.income.last_year_income,lastYearIncomeBeforeTax:r.income.last_year_income_before_tax,numberOfIncomeStreams:r.income.number_of_income_streams,maxOverlappingStreams:r.income.max_number_of_overlapping_income_streams,incomeStreams:r.income.income_streams.map(s=>({name:s.name,monthlyIncome:s.monthly_income,confidence:s.confidence,daysOfData:s.days})),incomeCategory:this.categorizeIncome(r.income.projected_yearly_income),currency:"USD"},verificationData:{verifiedAt:new Date().toISOString(),method:"plaid-income-verification",dataSource:"bank_transactions",analysisPeriodsMonths:12,confidenceScore:this.calculateOverallConfidence(r.income.income_streams)}},proof:await this.createProof(e,t,r)},n={id:i.id,credential:i,metadata:{name:"Income Verification",description:"Bank-verified income credential via Plaid",tags:["income","financial","plaid","verified","employment"],source:"plaid",issuer:"Plaid Inc.",issuedAt:i.issuanceDate,expiresAt:i.expirationDate,credentialType:"IncomeCredential"},storage:{encrypted:!0,pinned:!0,synced:!0}};return await v.storeCredential(n),n}catch(r){throw new Error(`Failed to create Plaid income credential: ${r instanceof Error?r.message:"Unknown error"}`)}}async createAssetCredential(e,t){if(!this.accessToken)throw new Error("Plaid access token required");try{const r=await this.fetchAssets(),i=r.accounts.reduce((u,p)=>u+p.balances.current,0),n=this.calculateAverageBalance(r.accounts),s={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/assets/v1"],id:`urn:uuid:plaid-assets-${Date.now()}`,type:["VerifiableCredential","AssetCredential","FinancialAssetCredential"],issuer:{id:"did:web:plaid.com",name:"Plaid Inc.",url:"https://plaid.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+720*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"AssetHolder",assetData:{totalCurrentBalance:i,averageBalance:n,numberOfAccounts:r.accounts.length,accountTypes:[...new Set(r.accounts.map(u=>u.type))],accountSubtypes:[...new Set(r.accounts.map(u=>u.subtype))],currency:r.accounts[0]?.balances.iso_currency_code||"USD",assetCategory:this.categorizeAssets(i),balanceStability:this.assessBalanceStability(r.accounts)},accounts:r.accounts.map(u=>({institutionName:u.official_name||u.name,accountType:u.type,accountSubtype:u.subtype,currentBalance:u.balances.current,averageBalance:this.calculateAccountAverageBalance(u.historical_balances),daysOfData:u.days_available,currency:u.balances.iso_currency_code})),verificationData:{verifiedAt:new Date().toISOString(),method:"plaid-asset-verification",dataSource:"bank_balances",analysisPeriodsMonths:3,balanceVerificationScore:this.calculateBalanceVerificationScore(r.accounts)}},proof:await this.createProof(e,t,r)},c={id:s.id,credential:s,metadata:{name:"Asset Verification",description:"Bank-verified asset credential via Plaid",tags:["assets","financial","plaid","verified","wealth"],source:"plaid",issuer:"Plaid Inc.",issuedAt:s.issuanceDate,expiresAt:s.expirationDate,credentialType:"AssetCredential"},storage:{encrypted:!0,pinned:!0,synced:!0}};return await v.storeCredential(c),c}catch(r){throw new Error(`Failed to create Plaid asset credential: ${r instanceof Error?r.message:"Unknown error"}`)}}async createFinancialCredential(e,t,r){if(!r)throw g.createError("PLAID_NO_ACCESS_TOKEN","Plaid access token required",D.AUTHENTICATION,j.HIGH,g.createContext({component:"plaid-vc",action:"create-credential"}),{retryable:!1,recoveryActions:["authenticate_plaid"],userMessage:"Please connect your bank account through Plaid first."});const i=N.checkRateLimit(e,"credential-creation");if(!i.allowed)throw g.createError("CREDENTIAL_CREATION_RATE_LIMIT","Credential creation rate limit exceeded",D.RATE_LIMIT,j.MEDIUM,g.createContext({component:"plaid-vc",action:"create-credential"}),{retryable:!0,recoveryActions:["wait_and_retry"],userMessage:`Rate limit exceeded. Please wait ${Math.ceil(i.retryAfter/1e3)} seconds and try again.`});this.setAccessToken(r);try{const[n,s,c]=await Promise.all([this.fetchIdentity().catch(()=>null),this.fetchIncome().catch(()=>null),this.fetchAssets().catch(()=>null)]),u=this.calculateFinancialMetrics(n,s,c),p={"@context":["https://www.w3.org/2018/credentials/v1","https://schema.org","https://personapass.xyz/contexts/financial/v1"],id:`urn:uuid:plaid-financial-${Date.now()}`,type:["VerifiableCredential","FinancialCredential","PlaidFinancialCredential"],issuer:{id:"did:web:plaid.com",name:"Plaid Inc.",url:"https://plaid.com"},issuanceDate:new Date().toISOString(),expirationDate:new Date(Date.now()+2160*60*60*1e3).toISOString(),credentialSubject:{id:e,type:"FinancialProfile",identity:n?{name:n.name,email:n.email,phone:n.phone,address:n.address,dateOfBirth:n.dateOfBirth,taxId:n.taxId?"***-**-"+n.taxId.slice(-4):void 0}:void 0,income:s?{totalMonthlyIncome:s.totalMonthlyIncome,primaryIncomeSource:s.primaryIncomeSource,incomeStability:s.incomeStability,employmentType:s.employmentType,payrollProvider:s.payrollProvider,lastPayDate:s.lastPayDate,projectedAnnualIncome:s.totalMonthlyIncome*12}:void 0,assets:c?{totalAssets:c.totalAssets,accountsCount:c.accountsCount,balanceStability:c.balanceStability,accountTypes:c.accountTypes,creditScore:c.creditScore,debtToIncomeRatio:s?(c.totalDebt||0)/(s.totalMonthlyIncome*12):void 0}:void 0,financialMetrics:u,verificationData:{verifiedAt:new Date().toISOString(),method:"plaid-api-integration",dataPoints:[n?"identity":null,s?"income":null,c?"assets":null].filter(Boolean),confidenceScore:this.calculateOverallConfidence(n?.9:0,s?.85:0,c?.8:0)}},proof:await this.createProof(e,t,{identity:n,income:s,assets:c})},h={id:p.id,credential:p,metadata:{name:`Financial Profile - ${n?.name||"Unknown"}`,description:"Comprehensive financial credential verified through Plaid",tags:["financial","plaid","banking","verified","income","assets"],source:"plaid",issuer:"Plaid Inc.",issuedAt:p.issuanceDate,expiresAt:p.expirationDate,credentialType:"FinancialCredential"},storage:{encrypted:!0,pinned:!0,synced:!0}};return await v.storeCredential(h),console.log("✅ Plaid Financial Credential created successfully:",{id:p.id,name:n?.name||"Unknown",dataPoints:p.credentialSubject.verificationData.dataPoints}),h}catch(n){throw g.logError("❌ Failed to create Plaid financial credential:",n),new Error(`Failed to create Plaid financial credential: ${n instanceof Error?n.message:"Unknown error"}`)}}calculateFinancialMetrics(e,t,r){const i={};return t&&(i.monthlyIncome=t.totalMonthlyIncome,i.annualIncome=t.totalMonthlyIncome*12,i.incomeStability=t.incomeStability,i.primaryIncomeSource=t.primaryIncomeSource),r&&(i.totalAssets=r.totalAssets,i.liquidAssets=r.liquidAssets||0,i.accountsCount=r.accountsCount,i.balanceStability=r.balanceStability),t&&r&&(i.savingsRate=r.totalAssets>0?r.totalAssets/(t.totalMonthlyIncome*12):0,i.financialHealthScore=this.calculateFinancialHealthScore(t,r)),i.riskProfile=this.assessRiskProfile(t,r),i.creditworthiness=this.assessCreditworthiness(t,r),i}calculateFinancialHealthScore(e,t){let r=0;return e.incomeStability==="stable"?r+=30:e.incomeStability==="moderate"?r+=20:r+=10,t.totalAssets>e.totalMonthlyIncome*6?r+=30:t.totalAssets>e.totalMonthlyIncome*3?r+=20:t.totalAssets>e.totalMonthlyIncome&&(r+=10),t.balanceStability==="stable"?r+=25:t.balanceStability==="moderate"?r+=15:r+=5,t.accountsCount>=3?r+=15:t.accountsCount>=2?r+=10:r+=5,Math.min(r,100)}assessRiskProfile(e,t){let r=0;e.incomeStability==="volatile"?r+=3:e.incomeStability==="moderate"&&(r+=1),t.balanceStability==="volatile"?r+=3:t.balanceStability==="moderate"&&(r+=1);const i=t.totalAssets/e.totalMonthlyIncome;return i<1?r+=2:i<3&&(r+=1),r>=5?"high":r>=3?"medium":"low"}assessCreditworthiness(e,t){let r=0;return e.totalMonthlyIncome>1e4?r+=3:e.totalMonthlyIncome>5e3?r+=2:e.totalMonthlyIncome>2e3&&(r+=1),e.incomeStability==="stable"?r+=3:e.incomeStability==="moderate"&&(r+=1),t.totalAssets>e.totalMonthlyIncome*6?r+=2:t.totalAssets>e.totalMonthlyIncome*3&&(r+=1),t.balanceStability==="stable"?r+=2:t.balanceStability==="moderate"&&(r+=1),r>=8?"excellent":r>=6?"good":r>=4?"fair":"poor"}async fetchIdentity(){const e=N.checkRateLimit(this.accessToken||"anonymous","plaid-api");if(!e.allowed)throw g.createError("PLAID_API_RATE_LIMIT","Plaid API rate limit exceeded",D.RATE_LIMIT,j.MEDIUM,g.createContext({component:"plaid-vc",action:"fetch-identity"}),{retryable:!0,recoveryActions:["wait_and_retry"],userMessage:`Plaid API rate limit exceeded. Please wait ${Math.ceil(e.retryAfter/1e3)} seconds and try again.`});try{const t=await fetch(`${this.baseURL}/identity/get`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"PersonaPass-Wallet/1.0"},body:JSON.stringify({client_id:this.clientId,secret:this.secret,access_token:this.accessToken})});if(!t.ok)throw N.recordFailedRequest(this.accessToken||"anonymous","plaid-api"),g.handleAPIError("Plaid",{status:t.status,statusText:t.statusText},g.createContext({component:"plaid-vc",action:"fetch-identity"}));const r=await t.json();return console.log("✅ Plaid identity data fetched successfully"),r}catch(t){throw N.recordFailedRequest(this.accessToken||"anonymous","plaid-api"),t instanceof Error&&t.name==="PersonaPassError"?t:g.handleAPIError("Plaid",t,g.createContext({component:"plaid-vc",action:"fetch-identity"}))}}async fetchIncome(){const e=await fetch(`${this.baseURL}/income/get`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Persona-Wallet/1.0"},body:JSON.stringify({client_id:this.clientId,secret:this.secret,access_token:this.accessToken})});if(!e.ok)throw new Error(`Plaid API error: ${e.status} ${e.statusText}`);return e.json()}async fetchAssets(){const e=await fetch(`${this.baseURL}/assets/report/get`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Persona-Wallet/1.0"},body:JSON.stringify({client_id:this.clientId,secret:this.secret,access_token:this.accessToken,days_requested:90})});if(!e.ok)throw new Error(`Plaid API error: ${e.status} ${e.statusText}`);return e.json()}hasDataPoint(e,t){switch(t){case"name":return e.identity.names.length>0;case"address":return e.identity.addresses.length>0;case"email":return e.identity.emails.length>0;case"phone":return e.identity.phone_numbers.length>0;case"bank_accounts":return e.accounts.length>0;default:return!1}}categorizeIncome(e){return e>=2e5?"high":e>=75e3?"upper-middle":e>=4e4?"middle":e>=25e3?"lower-middle":"low"}calculateOverallConfidence(e){if(e.length===0)return 0;const t=e.reduce((r,i)=>r+i.confidence,0);return Math.round(t/e.length*100)/100}calculateAverageBalance(e){if(e.length===0)return 0;const t=e.reduce((r,i)=>r+i.balances.current,0);return Math.round(t/e.length*100)/100}calculateAccountAverageBalance(e){if(e.length===0)return 0;const t=e.reduce((r,i)=>r+i.current,0);return Math.round(t/e.length*100)/100}categorizeAssets(e){return e>=1e6?"high-net-worth":e>=25e4?"affluent":e>=5e4?"moderate":e>=1e4?"emerging":"building"}assessBalanceStability(e){let t=0;e.forEach(i=>{if(i.historical_balances.length>0){const n=i.historical_balances.map(p=>p.current),s=this.calculateVariance(n),c=n.reduce((p,h)=>p+h,0)/n.length,u=Math.sqrt(s)/c;u<.1?t+=3:u<.3?t+=2:t+=1}});const r=t/e.length;return r>=2.5?"very-stable":r>=2?"stable":r>=1.5?"moderate":"variable"}calculateVariance(e){const t=e.reduce((i,n)=>i+n,0)/e.length;return e.map(i=>Math.pow(i-t,2)).reduce((i,n)=>i+n,0)/e.length}calculateBalanceVerificationScore(e){let t=0;return e.forEach(r=>{r.days_available>=90?t+=30:r.days_available>=60?t+=20:t+=10,r.historical_balances.length>=30?t+=20:r.historical_balances.length>=15?t+=15:t+=5}),Math.min(100,Math.round(t/e.length))}async createProof(e,t,r){const i={type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:`${e}#key-1`,proofPurpose:"assertionMethod"},n=JSON.stringify({...i,credentialHash:await de.generateHash(JSON.stringify(r))}),s=await U.signWithDID(new TextEncoder().encode(n),t);return{...i,proofValue:Array.from(s).map(c=>c.toString(16).padStart(2,"0")).join("")}}async revokeCredential(e){try{await v.deleteCredential(e)}catch(t){throw new Error(`Failed to revoke Plaid credential: ${t instanceof Error?t.message:"Unknown error"}`)}}}ae=Rt(null);Gt(ae,1,"createFinancialCredential",et,ee);Qe(ae,ee);function qt(){try{const o=$e.getThirdPartyConfig();return new ee(o.plaid.clientId,o.plaid.secret,o.plaid.environment)}catch(o){return console.warn("Configuration service not available, using fallback values:",o),new ee("your_plaid_client_id_here","your_plaid_secret_here","sandbox")}}const O=qt();class Jt{userDID=null;initializationPromise=null;async initializeDID(e){try{if(this.initializationPromise&&(await this.initializationPromise,this.userDID))return this.userDID;if(this.initializationPromise=this._performInitialization(e),await this.initializationPromise,this.initializationPromise=null,!this.userDID)throw new Error("Initialization failed to create userDID");return this.userDID}catch(t){throw this.initializationPromise=null,t}}async _performInitialization(e){try{if(!v){console.warn("Storage service not available, creating fallback DID"),await this._createFallbackDID();return}try{if(typeof v.getAllDIDs!="function"){console.warn("Storage service not properly initialized, creating fallback DID"),await this._createFallbackDID();return}}catch(n){console.warn("Storage service check failed, creating fallback DID:",n),await this._createFallbackDID();return}let t;if(e){const n=await U.generateDIDFromSeed(e);if(!n.success||!n.did)throw new Error("Failed to generate DID from seed: "+n.error);t={did:n.did,privateKey:n.privateKey,publicKey:n.publicKey,document:n.document}}else{let n=[];try{n=await v.getAllDIDs(),Array.isArray(n)||(n=[])}catch(s){console.warn("Failed to get existing DIDs from storage:",s),n=[]}if(n.length>0){const s=n[0];let c;try{if(s?.privateKey instanceof Uint8Array)c=s.privateKey;else if(s?.privateKey&&typeof s.privateKey=="object"&&s.privateKey!==null)try{const p=s.privateKey;if(Array.isArray(p)){const h=p.filter(l=>l!=null&&typeof l=="number");c=h.length>0?new Uint8Array(h):new Uint8Array(32)}else if(typeof p=="object"&&p!==null){const h=[];try{if(p&&typeof p=="object"){const l=Object.values(p);for(const f of l)f!=null&&typeof f=="number"&&h.push(f)}}catch(l){console.warn("Error extracting object values from private key:",l)}c=h.length>0?new Uint8Array(h):new Uint8Array(32)}else c=new Uint8Array(32)}catch(p){console.warn("Error processing private key object:",p),c=new Uint8Array(32)}else c=new Uint8Array(32)}catch(p){console.warn("Error processing stored private key:",p),c=new Uint8Array(32)}let u;try{if(s?.publicKey instanceof Uint8Array)u=s.publicKey;else if(s?.publicKey&&typeof s.publicKey=="object"&&s.publicKey!==null)try{const p=s.publicKey;if(Array.isArray(p)){const h=p.filter(l=>l!=null&&typeof l=="number");u=h.length>0?new Uint8Array(h):new Uint8Array(32)}else if(typeof p=="object"&&p!==null){const h=[];try{if(p&&typeof p=="object"){const l=Object.values(p);for(const f of l)f!=null&&typeof f=="number"&&h.push(f)}}catch(l){console.warn("Error extracting object values from public key:",l)}u=h.length>0?new Uint8Array(h):new Uint8Array(32)}else u=new Uint8Array(32)}catch(p){console.warn("Error processing public key object:",p),u=new Uint8Array(32)}else u=new Uint8Array(32)}catch(p){console.warn("Error processing stored public key:",p),u=new Uint8Array(32)}t={did:s?.id||`did:key:${Date.now()}`,privateKey:c,publicKey:u,document:s?.document||null}}else{const s=await U.generateDID();if(!s.success||!s.did)throw new Error("Failed to generate DID: "+s.error);t={did:s.did,privateKey:s.privateKey,publicKey:s.publicKey,document:s.document},await v.storeDID({id:t.did,method:"key",identifier:t.did.split(":").pop(),controller:t.did,created:new Date().toISOString(),updated:new Date().toISOString(),publicKeys:[{id:`${t.did}#key-1`,type:"Ed25519VerificationKey2020",controller:t.did,publicKeyBase58:btoa(String.fromCharCode(...Array.from(t.publicKey)))}],authentication:[`${t.did}#key-1`],keyAgreement:[`${t.did}#key-1`],capabilityInvocation:[`${t.did}#key-1`],privateKey:t.privateKey,publicKey:t.publicKey,document:t.document,keyType:"Ed25519",purposes:["authentication","keyAgreement","capabilityInvocation"]})}}let r=0,i=0;try{r=await this.getTotalVCCount()}catch(n){console.warn("Failed to get total VC count during DID initialization:",n)}try{i=await this.getTotalZKProofCount()}catch(n){console.warn("Failed to get total ZK proof count during DID initialization:",n)}return this.userDID={...t,vcMetadata:{credentialsIssued:0,credentialsReceived:0,totalVCs:r,zkProofsGenerated:i,createdAt:new Date().toISOString(),lastUsed:new Date().toISOString()}},console.log("[SUCCESS] DID initialized for VC operations:",this.userDID.did),this.userDID}catch(t){if(console.error("[ERROR] Failed to initialize DID for VC operations:",t),!this.userDID){console.warn("Creating fallback DID due to initialization failure");try{const r={did:`did:key:fallback-${Date.now()}`,privateKey:new Uint8Array(32),publicKey:new Uint8Array(32),document:null,vcMetadata:{credentialsIssued:0,credentialsReceived:0,totalVCs:0,zkProofsGenerated:0,createdAt:new Date().toISOString(),lastUsed:new Date().toISOString()}};return this.userDID=r,r}catch(r){throw console.error("Even fallback DID creation failed:",r),new Error(`Complete DID initialization failure: ${t instanceof Error?t.message:"Unknown error"}`)}}throw new Error(`Failed to initialize DID: ${t instanceof Error?t.message:"Unknown error"}`)}}async _createFallbackDID(){console.log("Creating fallback DID for safe operation");const e={did:`did:key:fallback-safe-${Date.now()}`,privateKey:new Uint8Array(32),publicKey:new Uint8Array(32),document:null,vcMetadata:{credentialsIssued:0,credentialsReceived:0,totalVCs:0,zkProofsGenerated:0,createdAt:new Date().toISOString(),lastUsed:new Date().toISOString()}};this.userDID=e,console.log("[SUCCESS] Fallback DID created safely:",this.userDID.did)}async createCredential(e){if(this.userDID||await this.initializeDID(),!this.userDID)throw new Error("Failed to initialize DID");const t={"@context":["https://www.w3.org/2018/credentials/v1"],type:Array.isArray(e.type)?e.type:[e.type],id:`urn:uuid:${Date.now()}-${Math.random().toString(36).substr(2,9)}`,issuer:e.issuer||this.userDID.did,issuanceDate:new Date().toISOString(),credentialSubject:{id:e.subject||this.userDID.did,...e},proof:await this.createCredentialProof(e)},r={id:t.id,credential:t,metadata:{createdAt:new Date().toISOString(),lastAccessed:new Date().toISOString(),source:e.issuer||"local",tags:[],revoked:!1}};return await v.storeCredential(r),await this.updateDIDMetadata("credential_created"),r}async createVC(e){return this.createCredential(e)}async storeCredential(e){let t;if("credential"in e)t=e;else{const r=e;t={id:r.id||`urn:uuid:${Date.now()}-${Math.random().toString(36).substr(2,9)}`,credential:r,metadata:{createdAt:new Date().toISOString(),lastAccessed:new Date().toISOString(),source:"external",tags:[],revoked:!1}}}await v.storeCredential(t),await this.updateDIDMetadata("credential_created")}async createCredentialFromAPI(e){try{if(this.userDID||await this.initializeDID(),!this.userDID)throw new Error("Failed to initialize DID");let t,r;switch(e.type){case"github":t=await this.createGitHubCredential(e);break;case"linkedin":t=await this.createLinkedInCredential(e);break;case"plaid":t=await this.createPlaidCredential(e);break;default:throw new Error(`Unsupported credential type: ${e.type}`)}if(e.zkProofEnabled)try{r=await zkProofService.createZKCredential(t.credential,this.userDID.did,this.userDID.privateKey),t.metadata.zkCommitment=r.commitment}catch(i){console.warn("ZK proof generation failed:",i)}return await this.updateDIDMetadata("credential_created"),{success:!0,credential:t,zkCredential:r,verificationData:{proofGenerated:!!r,zkCommitment:r?.commitment,verificationMethod:`${this.userDID.did}#key-1`}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async createGitHubCredential(e){if(!e.accessToken)throw new Error("GitHub access token is required");switch(J.setAccessToken(e.accessToken),e.subtype){case"contributor":if(!e.metadata?.repositoryUrl)throw new Error("Repository URL required for contributor credential");return J.createContributorCredential(this.userDID,this.userDID.privateKey,e.metadata.repositoryUrl);default:return J.createDeveloperCredential(this.userDID,this.userDID.privateKey)}}async createLinkedInCredential(e){if(!e.accessToken)throw new Error("LinkedIn access token is required");switch(Y.setAccessToken(e.accessToken),e.subtype){case"employment":if(!e.metadata?.positionId)throw new Error("Position ID required for employment credential");return Y.createEmploymentCredential(this.userDID,this.userDID.privateKey,e.metadata.positionId);default:return Y.createProfessionalCredential(this.userDID,this.userDID.privateKey)}}async createPlaidCredential(e){if(!e.accessToken)throw new Error("Plaid access token is required");switch(O.setAccessToken(e.accessToken),e.subtype){case"income":return O.createIncomeCredential(this.userDID,this.userDID.privateKey);case"assets":return O.createAssetCredential(this.userDID,this.userDID.privateKey);default:return O.createIdentityCredential(this.userDID,this.userDID.privateKey)}}async createMultipleCredentials(e){const t=[];for(const r of e)try{const i=await this.createCredentialFromAPI(r);t.push(i),await new Promise(n=>setTimeout(n,1e3))}catch(i){t.push({success:!1,error:i instanceof Error?i.message:"Unknown error"})}return t}async createPresentation(e,t,r,i=!1){if(!this.userDID)throw new Error("DID not initialized");try{const n=[];for(const s of e){const c=await v.getCredential(s);c&&n.push(c)}if(n.length===0)throw new Error("No valid credentials found");return i?this.createZKPresentation(n,t,r):this.createStandardPresentation(n,t,r)}catch(n){throw new Error(`Failed to create presentation: ${n instanceof Error?n.message:"Unknown error"}`)}}async createStandardPresentation(e,t,r){const i={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiablePresentation"],id:`urn:uuid:presentation-${Date.now()}`,holder:this.userDID.did,verifiableCredential:e.map(n=>n.credential),proof:await this.createPresentationProof(e,t,r)};return await this.updateDIDMetadata("presentation_created"),i}async createZKPresentation(e,t,r){const i=[];for(const s of e)if(s.metadata.zkCommitment){const c=await v.getZKCredential(s.id);if(c){const u=await zkProofService.generateProof(c,"selective_disclosure",[t,r]);i.push(u)}}else{const c=await zkProofService.createZKCredential(s.credential,this.userDID.did,this.userDID.privateKey),u=await zkProofService.generateProof(c,"selective_disclosure",[t,r]);i.push(u)}const n={"@context":["https://www.w3.org/2018/credentials/v1","https://personapass.xyz/contexts/zk-presentation/v1"],type:["VerifiablePresentation","ZKPresentation"],id:`urn:uuid:zk-presentation-${Date.now()}`,holder:this.userDID.did,zkProofs:i,proof:await this.createPresentationProof(e,t,r)};return await this.updateDIDMetadata("zk_presentation_created"),n}async createCredentialProof(e){const t={type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:`${this.userDID.did}#key-1`,proofPurpose:"assertionMethod"},r=JSON.stringify({...t,...e}),i=await U.signWithDID(new TextEncoder().encode(r),this.userDID.privateKey);return{...t,proofValue:Array.from(i).map(n=>n.toString(16).padStart(2,"0")).join("")}}async createPresentationProof(e,t,r){const i={type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:`${this.userDID.did}#key-1`,proofPurpose:"authentication",challenge:t,domain:r},n=JSON.stringify({...i,credentialIds:e.map(c=>c.id)}),s=await U.signWithDID(new TextEncoder().encode(n),this.userDID.privateKey);return{...i,proofValue:Array.from(s).map(c=>c.toString(16).padStart(2,"0")).join("")}}async revokeCredential(e,t="user_request"){try{const r=await v.getCredential(e);if(!r)throw new Error("Credential not found");switch(await v.updateCredential(e,{metadata:{...r.metadata,revoked:!0,revokedAt:new Date().toISOString(),revocationReason:t}}),r.metadata.source){case"github":await J.revokeCredential(e);break;case"linkedin":await Y.revokeCredential(e);break;case"plaid":await O.revokeCredential(e);break;default:await v.deleteCredential(e)}await this.updateDIDMetadata("credential_revoked")}catch(r){throw new Error(`Failed to revoke credential: ${r instanceof Error?r.message:"Unknown error"}`)}}getCurrentDID(){return this.userDID}async getDIDMetadata(){if(!this.userDID)return null;let e=this.userDID.vcMetadata?.totalVCs||0,t=this.userDID.vcMetadata?.zkProofsGenerated||0;try{e=await this.getTotalVCCount()}catch(r){console.warn("Failed to get total VC count for metadata:",r)}try{t=await this.getTotalZKProofCount()}catch(r){console.warn("Failed to get total ZK proof count for metadata:",r)}return{...this.userDID.vcMetadata,totalVCs:e,zkProofsGenerated:t}}async updateDIDMetadata(e){if(this.userDID){switch(e){case"credential_created":this.userDID.vcMetadata.credentialsReceived++,this.userDID.vcMetadata.totalVCs++;break;case"presentation_created":this.userDID.vcMetadata.credentialsIssued++;break;case"zk_presentation_created":this.userDID.vcMetadata.zkProofsGenerated++;break;case"credential_revoked":this.userDID.vcMetadata.totalVCs=Math.max(0,this.userDID.vcMetadata.totalVCs-1);break}this.userDID.vcMetadata.lastUsed=new Date().toISOString()}}async getTotalVCCount(){try{const e=await v.getCredentials();return!e||!Array.isArray(e)?(console.warn("getTotalVCCount: credentials is not a valid array:",typeof e),0):e.filter(t=>{try{return t&&t.metadata&&typeof t.metadata=="object"&&!t.metadata.revoked}catch(r){return console.warn("Error filtering credential:",t,r),!1}}).length}catch(e){return console.error("Error getting total VC count:",e),0}}async getTotalZKProofCount(){try{const e=await v.getZKCredentials();return!e||!Array.isArray(e)?(console.warn("getTotalZKProofCount: zkCredentials is not a valid array:",typeof e),0):e.length}catch(e){return console.error("Error getting total ZK proof count:",e),0}}async exportWalletData(e){if(!this.userDID)throw new Error("DID not initialized");try{const t=await v.getCredentials(),r=await v.getZKCredentials(),i={did:this.userDID,credentials:t,zkCredentials:r,exportedAt:new Date().toISOString(),version:"1.0"};return btoa(JSON.stringify(i))}catch(t){throw new Error(`Failed to export wallet data: ${t instanceof Error?t.message:"Unknown error"}`)}}async importWalletData(e,t){try{const r=JSON.parse(atob(e));this.userDID=r.did;for(const i of r.credentials)await v.storeCredential(i);for(const i of r.zkCredentials)await v.storeZKCredential(i)}catch(r){throw new Error(`Failed to import wallet data: ${r instanceof Error?r.message:"Unknown error"}`)}}}const oe=new Jt,Yt=kt("pk_test_51RmFHT9Wu5Y7RGx1SknegdzuY3BZIOc6sPvnmaVURFaffKj4AC364AsjBWYmnQiWrh4r75nk2xOiadys6DU27FEE0071WrOIXR");class Zt{stripe;initialized=!1;constructor(){this.initializeStripe()}async initializeStripe(){try{this.stripe=await Yt,this.initialized=!0}catch(e){throw g.logError("Failed to initialize Stripe:",e),new Error("Stripe initialization failed")}}async ensureInitialized(){this.initialized||await this.initializeStripe()}async createVerificationSession(e){await this.ensureInitialized();try{const t=await fetch("/api/stripe/identity/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({options:{document:{allowed_types:e.allowedDocumentTypes,require_id_number:e.requireIdNumber,require_live_capture:e.requireLiveCapture,require_matching_selfie:e.requireMatchingSelfie}},metadata:e.metadata||{}})});if(!t.ok)throw new Error(`Failed to create verification session: ${t.status}`);const r=await t.json();return $.trackEvent("identity_verification","session_created","stripe_identity",this.getUserId(),{sessionId:r.id,options:JSON.stringify(e),timestamp:Date.now()}),r}catch(t){throw g.logError("Error creating verification session:",t),t}}async startVerification(e={requireIdNumber:!0,requireLiveCapture:!0,requireMatchingSelfie:!0,allowedDocumentTypes:["driving_license","passport","id_card"]}){try{const t=await this.createVerificationSession(e),r=await this.stripe.verifyIdentity(t.client_secret);if(r.error)throw new Error(r.error.message);const i=await this.getVerificationSession(t.id);if(i.status==="verified"){const n=await this.createIdentityCredential(i);return $.trackEvent("identity_verification","verification_completed","stripe_identity",this.getUserId(),{sessionId:t.id,verified:!0,timestamp:Date.now()}),{verified:!0,session:i,credential:n}}return{verified:!1,session:i,error:"Verification not completed"}}catch(t){return g.logError("Identity verification error:",t),$.trackEvent("identity_verification","verification_failed","stripe_identity",this.getUserId(),{error:t.message,timestamp:Date.now()}),{verified:!1,session:null,error:t.message}}}async getVerificationSession(e){try{const t=await fetch(`/api/stripe/identity/session/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get verification session: ${t.status}`);return await t.json()}catch(t){throw g.logError("Error getting verification session:",t),t}}async createIdentityCredential(e){const t=e.verified_outputs;if(!t)throw new Error("No verified outputs available");const r={type:"IdentityVerification",issuer:"stripe_identity",subject:this.getUserId(),issuanceDate:new Date().toISOString(),credentialSubject:{id:this.getUserId(),verificationMethod:"government_id",verificationProvider:"stripe_identity",verificationSession:e.id,verifiedClaims:{...t.first_name&&{firstName:t.first_name},...t.last_name&&{lastName:t.last_name},...t.dob&&{dateOfBirth:`${t.dob.year}-${t.dob.month.toString().padStart(2,"0")}-${t.dob.day.toString().padStart(2,"0")}`},...t.address&&{address:{streetAddress:t.address.line1,...t.address.line2&&{streetAddress2:t.address.line2},city:t.address.city,state:t.address.state,postalCode:t.address.postal_code,country:t.address.country}},...t.id_number&&{idNumber:t.id_number,idNumberType:t.id_number_type}},verificationLevel:"government_id",verificationTimestamp:new Date(e.created*1e3).toISOString()}};return await oe.createCredential(r)}async verifyAge(e){try{const t=await this.startVerification({requireIdNumber:!1,requireLiveCapture:!0,requireMatchingSelfie:!0,allowedDocumentTypes:["driving_license","passport","id_card"],metadata:{purpose:"age_verification",minimumAge:e.toString()}});if(!t.verified)return{verified:!1,error:t.error};const r=t.session.verified_outputs?.dob;if(!r)return{verified:!1,error:"Date of birth not available"};const i=new Date(r.year,r.month-1,r.day),n=new Date,s=n.getFullYear()-i.getFullYear(),c=n.getMonth()-i.getMonth(),u=c<0||c===0&&n.getDate()<i.getDate()?s-1:s,p=u>=e,h=await oe.createCredential({type:"AgeVerification",issuer:"stripe_identity",subject:this.getUserId(),issuanceDate:new Date().toISOString(),credentialSubject:{id:this.getUserId(),ageVerified:p,minimumAge:e,verificationMethod:"government_id",verificationProvider:"stripe_identity",verificationTimestamp:new Date().toISOString()}});return{verified:p,age:u,credential:h}}catch(t){return g.logError("Age verification error:",t),{verified:!1,error:t.message}}}async verifyAddress(){try{const e=await this.startVerification({requireIdNumber:!1,requireLiveCapture:!0,requireMatchingSelfie:!1,allowedDocumentTypes:["driving_license","utility_bill","bank_statement"],metadata:{purpose:"address_verification"}});if(!e.verified)return{verified:!1,error:e.error};const t=e.session.verified_outputs?.address;if(!t)return{verified:!1,error:"Address not available"};const r=await oe.createCredential({type:"AddressVerification",issuer:"stripe_identity",subject:this.getUserId(),issuanceDate:new Date().toISOString(),credentialSubject:{id:this.getUserId(),verifiedAddress:{streetAddress:t.line1,...t.line2&&{streetAddress2:t.line2},city:t.city,state:t.state,postalCode:t.postal_code,country:t.country},verificationMethod:"government_id",verificationProvider:"stripe_identity",verificationTimestamp:new Date().toISOString()}});return{verified:!0,address:t,credential:r}}catch(e){return g.logError("Address verification error:",e),{verified:!1,error:e.message}}}async getVerificationHistory(){try{const e=await fetch("/api/stripe/identity/sessions",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get verification history: ${e.status}`);return(await e.json()).sessions||[]}catch(e){return g.logError("Error getting verification history:",e),[]}}async cancelVerification(e){try{const t=await fetch(`/api/stripe/identity/cancel/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to cancel verification: ${t.status}`);return $.trackEvent("identity_verification","verification_cancelled","stripe_identity",this.getUserId(),{sessionId:e,timestamp:Date.now()}),!0}catch(t){return g.logError("Error cancelling verification:",t),!1}}getUserId(){return localStorage.getItem("persona_user_id")||"anonymous"}async checkConfiguration(){try{return await this.ensureInitialized(),(await fetch("/api/stripe/identity/config",{method:"GET",headers:{"Content-Type":"application/json"}})).ok?{configured:!0}:{configured:!1,error:"Stripe Identity API not available"}}catch(e){return{configured:!1,error:e.message}}}}const X=new Zt,Xt=({onVerificationComplete:o,onVerificationError:e,verificationType:t="full",minimumAge:r=18,allowedDocumentTypes:i=["driving_license","passport","id_card"],className:n=""})=>{const[s,c]=k.useState("idle"),[u,p]=k.useState(null),[h,l]=k.useState(null),[f,y]=k.useState(0),[S,I]=k.useState(!1);k.useEffect(()=>{_()},[]);const _=async()=>{try{const b=await X.checkConfiguration();I(b.configured),b.configured||l(b.error||"Stripe Identity not configured")}catch{l("Failed to check configuration")}},C=async()=>{try{c("starting"),l(null),y(25),$.trackEvent("identity_verification","verification_started","stripe_identity",localStorage.getItem("persona_user_id")||"anonymous",{type:t,minimumAge:r.toString(),allowedDocumentTypes:JSON.stringify(i),timestamp:Date.now()}),y(50);let b;switch(t){case"age":b=await X.verifyAge(r);break;case"address":b=await X.verifyAddress();break;default:b=await X.startVerification({requireIdNumber:!0,requireLiveCapture:!0,requireMatchingSelfie:!0,allowedDocumentTypes:i,metadata:{purpose:t,timestamp:Date.now().toString()}})}y(100),b.verified?(c("completed"),p(b.session),o?.(b)):(c("error"),l(b.error||"Verification failed"),e?.(b.error||"Verification failed"))}catch(b){g.logError("Verification error:",b),c("error"),l(b.message||"Verification failed"),e?.(b.message||"Verification failed")}},m=()=>{c("idle"),p(null),l(null),y(0)},x=()=>{switch(t){case"age":return`Age Verification (${r}+)`;case"address":return"Address Verification";default:return"Identity Verification"}},d=()=>{switch(t){case"age":return`Verify you are ${r} years or older using government-issued ID`;case"address":return"Verify your current address using government-issued ID or utility bill";default:return"Verify your identity using government-issued ID with live capture"}},w=()=>{switch(t){case"age":return"🎂";case"address":return"🏠";default:return"🆔"}};return S?a.jsx("div",{className:`bg-white rounded-xl shadow-lg border border-gray-200 ${n}`,children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"text-6xl mb-4",children:w()}),a.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:x()}),a.jsx("p",{className:"text-gray-600",children:d()})]}),s!=="idle"&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Progress"}),a.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[f,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx(E.div,{className:"bg-gradient-to-r from-orange-500 to-orange-600 h-2 rounded-full",initial:{width:0},animate:{width:`${f}%`},transition:{duration:.5}})})]}),a.jsxs(at,{mode:"wait",children:[s==="idle"&&a.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[a.jsxs("div",{className:"space-y-4 mb-8",children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[a.jsx("span",{className:"text-2xl",children:"🔒"}),a.jsx("span",{className:"font-medium",children:"Powered by Stripe Identity"})]}),a.jsx("div",{className:"text-sm text-gray-600",children:"Your personal information is processed securely and never stored"})]}),a.jsxs("div",{className:"space-y-4 mb-8",children:[a.jsx("h3",{className:"text-lg font-semibold text-black",children:"What you'll need:"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("div",{className:"text-2xl mb-2",children:"📱"}),a.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Device Camera"}),a.jsx("div",{className:"text-xs text-gray-600",children:"For live capture"})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("div",{className:"text-2xl mb-2",children:"🪪"}),a.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Government ID"}),a.jsxs("div",{className:"text-xs text-gray-600",children:[i.includes("driving_license")&&"Driver's License, ",i.includes("passport")&&"Passport, ",i.includes("id_card")&&"ID Card"]})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("div",{className:"text-2xl mb-2",children:"⏱️"}),a.jsx("div",{className:"text-sm font-medium text-gray-900",children:"2-3 Minutes"}),a.jsx("div",{className:"text-xs text-gray-600",children:"Quick process"})]})]})]}),a.jsx("button",{onClick:C,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:"Start Verification"})]},"idle"),s==="starting"&&a.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"🔄"}),a.jsx("h3",{className:"text-xl font-semibold text-black mb-2",children:"Preparing Verification"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Setting up secure verification session..."}),a.jsx("div",{className:"flex justify-center space-x-2",children:[0,1,2].map(b=>a.jsx(E.div,{animate:{scale:[1,1.2,1]},transition:{duration:.8,repeat:1/0,delay:b*.2},className:"w-3 h-3 bg-orange-500 rounded-full"},b))})]},"starting"),s==="in_progress"&&a.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"📸"}),a.jsx("h3",{className:"text-xl font-semibold text-black mb-2",children:"Verification in Progress"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Follow the instructions in the verification window"}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"text-blue-800 text-sm",children:[a.jsx("strong",{children:"Tip:"})," Make sure you have good lighting and hold your ID steady"]})})]},"in_progress"),s==="completed"&&a.jsxs(E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"✅"}),a.jsx("h3",{className:"text-xl font-semibold text-green-600 mb-2",children:"Verification Complete!"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Your identity has been successfully verified and a credential has been added to your wallet."}),u&&a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"text-sm text-green-800",children:[a.jsx("div",{className:"font-medium",children:"Verification Details:"}),a.jsxs("div",{children:["Session ID: ",u.id]}),a.jsxs("div",{children:["Verified: ",new Date(u.created*1e3).toLocaleString()]})]})}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("button",{onClick:m,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded-lg font-medium transition-colors",children:"Verify Again"}),a.jsx("button",{onClick:()=>window.location.href="/credentials",className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg font-medium transition-all",children:"View Credential"})]})]},"completed"),s==="error"&&a.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"❌"}),a.jsx("h3",{className:"text-xl font-semibold text-red-600 mb-2",children:"Verification Failed"}),a.jsx("p",{className:"text-gray-600 mb-6",children:h||"Something went wrong during verification. Please try again."}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"text-sm text-red-800",children:[a.jsx("div",{className:"font-medium",children:"Common Issues:"}),a.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[a.jsx("li",{children:"Poor lighting or blurry photos"}),a.jsx("li",{children:"Expired or damaged ID"}),a.jsx("li",{children:"Camera permission denied"}),a.jsx("li",{children:"Network connectivity issues"})]})]})}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("button",{onClick:m,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded-lg font-medium transition-colors",children:"Cancel"}),a.jsx("button",{onClick:C,className:"flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-4 py-2 rounded-lg font-medium transition-all",children:"Try Again"})]})]},"error")]})]})}):a.jsx("div",{className:`bg-red-50 border border-red-200 rounded-lg p-6 ${n}`,children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),a.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Identity Verification Unavailable"}),a.jsx("p",{className:"text-red-600",children:h||"Stripe Identity is not properly configured"})]})})},Qt=({userId:o,onSuccess:e,onError:t})=>{const[r,i]=k.useState(!1),[n,s]=k.useState(null),[c,u]=k.useState("idle"),[p,h]=k.useState(null),[l,f]=k.useState(null);k.useEffect(()=>{y()},[o]);const y=async()=>{i(!0),u("loading");try{const m=await fetch("/api/plaid/create-link-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o,client_name:"PersonaPass",products:["transactions","identity","assets","income"],country_codes:["US"],language:"en",webhook:"https://personapass.xyz/api/plaid/webhook"})});if(!m.ok)throw new Error("Failed to create link token");const x=await m.json();s(x.link_token),u("ready")}catch(m){g.logError("Error creating link token:",m),h(m instanceof Error?m.message:"Unknown error"),u("error"),t?.(m instanceof Error?m.message:"Unknown error")}finally{i(!1)}},S=async(m,x)=>{u("loading");try{const d=await fetch("/api/plaid/exchange-public-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({public_token:m,user_id:o})});if(!d.ok)throw new Error("Failed to exchange public token");const w=await d.json();f({public_token:m,metadata:x}),u("success"),e?.(w)}catch(d){g.logError("Error exchanging public token:",d),h(d instanceof Error?d.message:"Unknown error"),u("error"),t?.(d instanceof Error?d.message:"Unknown error")}},I=m=>{g.logError("Plaid Link error:",m),h(m.error_message||"Unknown error"),u("error"),t?.(m.error_message||"Unknown error")},_=()=>{if(!n){g.logError("No link token available");return}setTimeout(()=>{S("mock_public_token",{institution:{name:"Chase Bank",institution_id:"ins_56"},accounts:[{id:"account_1",name:"Chase Checking",type:"depository",subtype:"checking",mask:"1234"},{id:"account_2",name:"Chase Savings",type:"depository",subtype:"savings",mask:"5678"}]})},2e3)},C=()=>{switch(c){case"loading":return a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Setting up secure connection..."})]});case"ready":return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(Te,{className:"h-8 w-8 text-blue-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Connect Your Bank Account"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Securely connect your bank account to verify your financial information. We use bank-level security to protect your data."})]}),a.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(be,{className:"h-5 w-5 text-blue-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-blue-900",children:"Secure & Private"}),a.jsx("p",{className:"text-sm text-blue-800",children:"Your banking credentials are encrypted and never stored on our servers. We only access the information needed for verification."})]})]})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(T,{className:"h-5 w-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Verify account ownership"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(T,{className:"h-5 w-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Confirm income and employment"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(T,{className:"h-5 w-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Validate financial stability"})]})]}),a.jsx("button",{onClick:_,disabled:r,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Connecting...":"Connect Bank Account"}),a.jsx("p",{className:"text-xs text-gray-500 text-center",children:"By connecting your account, you agree to our Terms of Service and Privacy Policy. You can disconnect at any time."})]});case"success":return a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(T,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Connection Successful!"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Your bank account has been successfully connected and verified."}),l&&a.jsx("div",{className:"bg-green-50 rounded-lg p-4 mb-4",children:a.jsxs("div",{className:"text-left",children:[a.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"Connected Institution"}),a.jsx("p",{className:"text-sm text-green-800 mb-3",children:l.metadata.institution.name}),a.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"Connected Accounts"}),a.jsx("div",{className:"space-y-1",children:l.metadata.accounts.map((m,x)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsxs("span",{className:"text-green-800",children:[m.name," (****",m.mask,")"]}),a.jsx("span",{className:"text-green-600 capitalize",children:m.subtype})]},x))})]})}),a.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(be,{className:"h-5 w-5 text-blue-600 mt-0.5"}),a.jsxs("div",{className:"text-left",children:[a.jsx("h4",{className:"font-medium text-blue-900",children:"What's Next?"}),a.jsx("p",{className:"text-sm text-blue-800",children:"Your financial data is now being processed to create your verification proofs. This may take a few minutes."})]})]})})]});case"error":return a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(ce,{className:"h-8 w-8 text-red-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Connection Failed"}),a.jsx("p",{className:"text-gray-600 mb-6",children:p||"There was an error connecting your bank account. Please try again."}),a.jsx("button",{onClick:y,className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]});default:return a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(Q,{className:"h-8 w-8 text-gray-600"})}),a.jsx("p",{className:"text-gray-600",children:"Initializing..."})]})}};return a.jsx("div",{className:"max-w-md mx-auto",children:C()})};function tt(...o){return o.filter(Boolean).join(" ")}const A=({variant:o="primary",size:e="md",children:t,onClick:r,disabled:i,loading:n,className:s,icon:c,iconPosition:u="left"})=>{const p=`
    relative overflow-hidden font-medium transition-all duration-300 ease-out
    focus:outline-none focus:ring-4 focus:ring-opacity-50
    disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none
    transform hover:scale-[1.02] active:scale-[0.98]
    shadow-lg hover:shadow-xl active:shadow-md
    flex items-center justify-center gap-2
    rounded-xl border-0
  `,h={sm:"px-4 py-2 text-sm min-h-[36px]",md:"px-6 py-3 text-base min-h-[44px]",lg:"px-8 py-4 text-lg min-h-[52px]",xl:"px-10 py-5 text-xl min-h-[60px]"},l={primary:`
      bg-gradient-to-r from-blue-600 via-blue-700 to-blue-800 
      text-white shadow-blue-500/25
      hover:from-blue-700 hover:via-blue-800 hover:to-blue-900 
      hover:shadow-blue-500/40
      focus:ring-blue-500
      before:absolute before:inset-0 before:bg-gradient-to-r 
      before:from-white/20 before:via-white/10 before:to-transparent 
      before:opacity-0 hover:before:opacity-100 before:transition-opacity
    `,secondary:`
      bg-gradient-to-r from-gray-200 via-gray-300 to-gray-400 
      text-gray-900 shadow-gray-500/25
      hover:from-gray-300 hover:via-gray-400 hover:to-gray-500
      hover:shadow-gray-500/40
      focus:ring-gray-500
      before:absolute before:inset-0 before:bg-gradient-to-r 
      before:from-white/30 before:via-white/20 before:to-transparent 
      before:opacity-0 hover:before:opacity-100 before:transition-opacity
    `,success:`
      bg-gradient-to-r from-green-600 via-green-700 to-green-800 
      text-white shadow-green-500/25
      hover:from-green-700 hover:via-green-800 hover:to-green-900
      hover:shadow-green-500/40
      focus:ring-green-500
      before:absolute before:inset-0 before:bg-gradient-to-r 
      before:from-white/20 before:via-white/10 before:to-transparent 
      before:opacity-0 hover:before:opacity-100 before:transition-opacity
    `,danger:`
      bg-gradient-to-r from-red-600 via-red-700 to-red-800 
      text-white shadow-red-500/25
      hover:from-red-700 hover:via-red-800 hover:to-red-900
      hover:shadow-red-500/40
      focus:ring-red-500
      before:absolute before:inset-0 before:bg-gradient-to-r 
      before:from-white/20 before:via-white/10 before:to-transparent 
      before:opacity-0 hover:before:opacity-100 before:transition-opacity
    `,ghost:`
      bg-transparent text-gray-700 shadow-none
      hover:bg-gray-100 hover:shadow-md
      focus:ring-gray-500
      border-2 border-gray-300 hover:border-gray-400
    `,gradient:`
      bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 
      text-white shadow-purple-500/25
      hover:from-purple-700 hover:via-pink-700 hover:to-blue-700
      hover:shadow-purple-500/40
      focus:ring-purple-500
      before:absolute before:inset-0 before:bg-gradient-to-r 
      before:from-white/20 before:via-white/10 before:to-transparent 
      before:opacity-0 hover:before:opacity-100 before:transition-opacity
    `},f=a.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return a.jsxs("button",{className:tt(p,h[e],l[o],s),onClick:r,disabled:i||n,children:[!i&&a.jsx("div",{className:"absolute inset-0 -top-px bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 translate-x-[-100%] hover:translate-x-[100%] transition-transform duration-1000"}),a.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[n&&f,!n&&c&&u==="left"&&c,!n&&t,!n&&c&&u==="right"&&c]})]})},P=({variant:o="default",size:e="md",children:t,className:r,onClick:i,hoverable:n=!0,glowColor:s="blue"})=>{const c=`
    relative overflow-hidden transition-all duration-300 ease-out
    rounded-2xl border backdrop-blur-sm
    ${i?"cursor-pointer":""}
    ${n?"hover:scale-[1.02] active:scale-[0.98]":""}
  `,u={sm:"p-4",md:"p-6",lg:"p-8",xl:"p-10"},p={default:`
      bg-white/80 border-gray-200/50 shadow-lg
      hover:shadow-xl hover:shadow-gray-500/10
      dark:bg-gray-800/80 dark:border-gray-700/50
    `,elevated:`
      bg-white/90 border-gray-200/30 shadow-2xl
      hover:shadow-3xl hover:shadow-gray-500/20
      dark:bg-gray-800/90 dark:border-gray-700/30
    `,glass:`
      bg-white/10 border-white/20 shadow-xl backdrop-blur-xl
      hover:bg-white/20 hover:border-white/30
      dark:bg-gray-900/10 dark:border-gray-700/20
    `,gradient:`
      bg-gradient-to-br from-white via-blue-50/50 to-purple-50/50
      border-gradient-to-br border-blue-200/30 border-purple-200/30
      shadow-lg hover:shadow-2xl
      dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20
    `,neon:`
      bg-gray-900/90 border-${s}-500/50 shadow-2xl
      hover:shadow-${s}-500/20 hover:border-${s}-400/70
      shadow-${s}-500/10
    `,minimal:`
      bg-transparent border-gray-300/50 shadow-none
      hover:bg-gray-50/50 hover:border-gray-400/70
      dark:border-gray-600/50 dark:hover:bg-gray-800/50
    `},h={blue:"shadow-blue-500/10 hover:shadow-blue-500/20",purple:"shadow-purple-500/10 hover:shadow-purple-500/20",green:"shadow-green-500/10 hover:shadow-green-500/20",pink:"shadow-pink-500/10 hover:shadow-pink-500/20",orange:"shadow-orange-500/10 hover:shadow-orange-500/20",cyan:"shadow-cyan-500/10 hover:shadow-cyan-500/20"};return a.jsxs("div",{className:tt(c,u[e],p[o],o==="neon"&&h[s],r),onClick:i,children:[o==="gradient"&&a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-pink-500/5 animate-gradient-xy opacity-0 hover:opacity-100 transition-opacity duration-500"}),n&&a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -skew-x-12 translate-x-[-100%] hover:translate-x-[100%] transition-transform duration-1000"}),a.jsx("div",{className:"relative z-10",children:t})]})},er=({variant:o="default",animated:e=!0,className:t=""})=>{const r={default:"from-blue-50 via-white to-purple-50",aurora:"from-green-400 via-blue-500 to-purple-600",sunset:"from-orange-400 via-pink-500 to-purple-600",ocean:"from-blue-400 via-teal-500 to-green-400",forest:"from-green-400 via-teal-500 to-blue-500",cosmic:"from-purple-900 via-blue-900 to-indigo-900"};return a.jsxs("div",{className:`absolute inset-0 ${t}`,children:[a.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${r[o]}`}),e&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-gradient-x"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-white/10 to-transparent animate-gradient-y"})]}),e&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute top-20 left-20 w-96 h-96 bg-blue-300/20 rounded-full blur-3xl animate-float"}),a.jsx("div",{className:"absolute top-40 right-20 w-80 h-80 bg-purple-300/20 rounded-full blur-3xl animate-float-delayed"}),a.jsx("div",{className:"absolute bottom-20 left-1/3 w-72 h-72 bg-pink-300/20 rounded-full blur-3xl animate-float-slow"})]}),a.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}})]})},tr=({didKeyPair:o})=>{const[e,t]=k.useState([]),[r,i]=k.useState(!0),[n,s]=k.useState(null),[c,u]=k.useState(null);k.useEffect(()=>{p()},[o]);const p=async()=>{i(!0);try{const d=localStorage.getItem(`verifications_${o.did}`),w=[{id:"stripe_identity",type:"identity",name:"Government ID Verification",description:"Verify your identity with government-issued documents",status:"not_started",provider:"Stripe Identity",icon:it,color:"blue"},{id:"plaid_banking",type:"financial",name:"Bank Account Verification",description:"Connect and verify your bank accounts",status:"not_started",provider:"Plaid",icon:Te,color:"green"},{id:"plaid_income",type:"income",name:"Income Verification",description:"Verify your employment and income",status:"not_started",provider:"Plaid",icon:nt,color:"purple"},{id:"plaid_assets",type:"financial",name:"Asset Verification",description:"Verify your financial assets and holdings",status:"not_started",provider:"Plaid",icon:st,color:"indigo"},{id:"employment_verification",type:"employment",name:"Employment Verification",description:"Verify your current employment status",status:"not_started",provider:"WorkNumber",icon:ot,color:"orange"}];if(d){const b=JSON.parse(d);t(b)}else t(w)}catch(d){g.logError("Failed to load verification status:",d)}finally{i(!1)}},h=(d,w)=>{t(b=>{const ve=b.map(ie=>ie.id===d?{...ie,...w}:ie);return localStorage.setItem(`verifications_${o.did}`,JSON.stringify(ve)),ve})},l=d=>{s(d.id),h(d.id,{status:"in_progress"})},f=(d,w)=>{h(d,{status:"completed",completedAt:new Date().toISOString(),data:w}),s(null)},y=(d,w)=>{h(d,{status:"failed"}),s(null)},S=d=>{switch(d){case"completed":return"bg-green-100 text-green-800 border-green-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"expired":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},I=d=>{switch(d){case"completed":return T;case"in_progress":return Q;case"failed":return B;case"expired":return ce;default:return Q}},_=e.filter(d=>d.status==="completed"),C=e.filter(d=>d.status==="in_progress"),m=e.filter(d=>d.status==="failed"),x=d=>{switch(d.id){case"stripe_identity":return a.jsx(Xt,{onVerificationComplete:w=>f(d.id,{sessionId:w}),onError:w=>y(d.id,w)});case"plaid_banking":case"plaid_income":case"plaid_assets":return a.jsx(Qt,{userId:o.did,onSuccess:w=>f(d.id,w),onError:w=>y(d.id,w)});default:return a.jsxs("div",{className:"text-center p-8",children:[a.jsx("p",{className:"text-gray-600 mb-4",children:"This verification is coming soon!"}),a.jsx("button",{onClick:()=>s(null),className:"btn btn-secondary",children:"Close"})]})}};return a.jsxs("div",{className:"relative min-h-screen",children:[a.jsx(er,{variant:"aurora",animated:!0,className:"fixed inset-0 z-0"}),a.jsxs("div",{className:"relative z-10 space-y-8 p-6",children:[a.jsxs(P,{variant:"glass",size:"lg",className:"backdrop-blur-xl",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx(ct,{className:"h-8 w-8 text-purple-600"}),a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 via-blue-600 to-green-600 bg-clip-text text-transparent",children:"Identity Verification"})]}),a.jsx("p",{className:"text-gray-700 text-lg font-medium",children:"Complete your identity verification to unlock all features"})]}),a.jsx("div",{className:"text-right",children:a.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-blue-500 bg-clip-text text-transparent",children:[a.jsxs("p",{className:"text-4xl font-bold",children:[_.length,"/",e.length]}),a.jsx("p",{className:"text-sm font-semibold text-gray-600",children:"Completed"})]})})]}),a.jsxs("div",{className:"mt-6",children:[a.jsxs("div",{className:"flex justify-between text-sm font-medium text-gray-700 mb-3",children:[a.jsx("span",{children:"Verification Progress"}),a.jsxs("span",{className:"text-purple-600 font-bold",children:[Math.round(_.length/e.length*100),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200/50 rounded-full h-3 shadow-inner",children:a.jsx("div",{className:"bg-gradient-to-r from-purple-500 via-blue-500 to-green-500 h-3 rounded-full transition-all duration-1000 ease-out shadow-lg",style:{width:`${_.length/e.length*100}%`}})})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[{label:"Completed",value:_.length,icon:T,color:"green",gradient:"from-green-400 to-emerald-500"},{label:"In Progress",value:C.length,icon:Q,color:"blue",gradient:"from-blue-400 to-cyan-500"},{label:"Failed",value:m.length,icon:B,color:"red",gradient:"from-red-400 to-pink-500"},{label:"Remaining",value:e.length-_.length,icon:ce,color:"gray",gradient:"from-gray-400 to-slate-500"}].map((d,w)=>{const b=d.icon;return a.jsx(P,{variant:"glass",size:"md",hoverable:!0,className:"group",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 group-hover:text-gray-800 transition-colors",children:d.label}),a.jsx("p",{className:"text-3xl font-bold text-gray-900 group-hover:scale-105 transition-transform",children:d.value})]}),a.jsx("div",{className:`h-14 w-14 rounded-xl flex items-center justify-center bg-gradient-to-r ${d.gradient} shadow-lg group-hover:shadow-xl transition-shadow`,children:a.jsx(b,{className:"h-7 w-7 text-white"})})]})},w)})}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:e.map(d=>{const w=d.icon,b=I(d.status);return a.jsxs(P,{variant:"elevated",size:"lg",hoverable:!0,className:"group transition-all duration-300 hover:scale-[1.02]",children:[a.jsxs("div",{className:"flex items-start justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:`h-14 w-14 rounded-xl flex items-center justify-center bg-gradient-to-r from-${d.color}-400 to-${d.color}-500 shadow-lg group-hover:shadow-xl transition-shadow`,children:a.jsx(w,{className:"h-7 w-7 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 group-hover:text-gray-800",children:d.name}),a.jsx("p",{className:"text-sm font-medium text-gray-600",children:d.provider})]})]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsxs("span",{className:`inline-flex items-center px-3 py-1 text-xs font-bold rounded-full border-2 ${S(d.status)} shadow-sm`,children:[a.jsx(b,{className:"h-3 w-3 mr-1"}),d.status.replace("_"," ").toUpperCase()]})})]}),a.jsx("p",{className:"text-gray-700 mb-6 leading-relaxed",children:d.description}),d.status==="completed"&&a.jsxs("div",{className:"text-sm text-green-600 mb-6 font-medium bg-green-50 p-3 rounded-lg border border-green-200",children:["✓ Completed on ",new Date(d.completedAt).toLocaleDateString()]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center space-x-3",children:d.status==="completed"&&a.jsxs(a.Fragment,{children:[a.jsx(A,{variant:"ghost",size:"sm",onClick:()=>u(d.id),icon:a.jsx(lt,{className:"h-4 w-4"}),children:"View Details"}),a.jsx(A,{variant:"ghost",size:"sm",icon:a.jsx(dt,{className:"h-4 w-4"}),children:"Share Proof"})]})}),a.jsxs("div",{children:[d.status==="not_started"&&a.jsx(A,{variant:"primary",size:"md",onClick:()=>l(d),icon:a.jsx(ne,{className:"h-4 w-4"}),iconPosition:"right",children:"Start Verification"}),d.status==="in_progress"&&a.jsx(A,{variant:"primary",size:"md",onClick:()=>l(d),icon:a.jsx(ne,{className:"h-4 w-4"}),iconPosition:"right",children:"Continue"}),d.status==="failed"&&a.jsx(A,{variant:"danger",size:"md",onClick:()=>l(d),icon:a.jsx(ne,{className:"h-4 w-4"}),iconPosition:"right",children:"Retry"}),d.status==="completed"&&a.jsxs("div",{className:"text-lg text-green-600 font-bold flex items-center space-x-2",children:[a.jsx(T,{className:"h-6 w-6"}),a.jsx("span",{children:"✓ Verified"})]})]})]})]},d.id)})}),n&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:a.jsxs(P,{variant:"glass",size:"xl",className:"max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"p-8 border-b border-gray-200/50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent",children:e.find(d=>d.id===n)?.name}),a.jsx(A,{variant:"ghost",size:"sm",onClick:()=>s(null),icon:a.jsx(B,{className:"h-5 w-5"}),children:"Close"})]})}),a.jsx("div",{className:"p-8",children:x(e.find(d=>d.id===n))})]})}),c&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:a.jsxs(P,{variant:"glass",size:"xl",className:"max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"p-8 border-b border-gray-200/50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent",children:"Verification Details"}),a.jsx(A,{variant:"ghost",size:"sm",onClick:()=>u(null),icon:a.jsx(B,{className:"h-5 w-5"}),children:"Close"})]})}),a.jsx("div",{className:"p-8",children:(()=>{const d=e.find(w=>w.id===c);return d?a.jsxs("div",{className:"space-y-6",children:[a.jsx(P,{variant:"minimal",size:"md",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Verification Type"}),a.jsx("p",{className:"text-lg text-gray-900 font-semibold",children:d.name})]})}),a.jsx(P,{variant:"minimal",size:"md",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Provider"}),a.jsx("p",{className:"text-lg text-gray-900 font-semibold",children:d.provider})]})}),a.jsx(P,{variant:"minimal",size:"md",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Status"}),a.jsx("span",{className:`inline-flex px-4 py-2 text-sm font-bold rounded-full ${S(d.status)} shadow-lg`,children:d.status.replace("_"," ").toUpperCase()})]})}),d.completedAt&&a.jsx(P,{variant:"minimal",size:"md",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Completed At"}),a.jsx("p",{className:"text-lg text-gray-900 font-semibold",children:new Date(d.completedAt).toLocaleString()})]})}),d.data&&a.jsx(P,{variant:"minimal",size:"md",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Verification Data"}),a.jsx("pre",{className:"text-sm text-gray-900 bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl overflow-x-auto border-2 border-gray-200 shadow-inner",children:JSON.stringify(d.data,null,2)})]})})]}):null})()})]})})]})]})},ir=()=>{const[o,e]=k.useState(null),[t,r]=k.useState(!0);k.useEffect(()=>{i()},[]);const i=async()=>{try{$.trackPageView("/identity-verification"),$.trackEvent("page_view","identity_verification","masterful_dashboard",localStorage.getItem("persona_user_id")||"anonymous",{timestamp:Date.now(),beautiful_ui:!0});const n=localStorage.getItem("persona_did");let s;n?s={did:n,publicKey:localStorage.getItem("persona_public_key"),privateKey:localStorage.getItem("persona_private_key")}:(s=await Ue.generateDID(),localStorage.setItem("persona_did",s.did),localStorage.setItem("persona_public_key",s.publicKey),localStorage.setItem("persona_private_key",s.privateKey)),e(s)}catch(n){g.logError("Failed to initialize verification page:",n);const s={did:`did:persona:${Date.now()}`,publicKey:"fallback_public_key",privateKey:"fallback_private_key"};e(s)}finally{r(!1)}};return t?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Loading beautiful verification dashboard..."})]})}):a.jsx("div",{className:"min-h-screen",children:a.jsx(tr,{didKeyPair:o})})};export{ir as IdentityVerificationPage};
